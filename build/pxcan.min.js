"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pxcan=function t(e){function n(t,e){"function"==typeof e?Object.defineProperty(w,t,{get:e}):Object.defineProperty(w,t,e)}function i(t,e){k.width=(m=Math.floor(t/y))*y,k.height=(v=Math.floor(e/y))*y}function A(t,e){k.width!==m*y&&(k.width=m*y),k.height!==v*y&&(k.height=v*y)}function r(t,e){p.minWidth*e==p.minHeight*t?(m=p.minWidth,v=p.minHeight):p.minWidth*e<p.minHeight*t?(m=Math.floor(t/e*p.minHeight),v=p.minHeight):(m=p.minWidth,v=Math.floor(e/t*p.minWidth)),y=Math.floor(Math.min(e/v,t/m)),y<1&&(y=1),k.width=m*y,k.height=v*y}function o(){++C,C>w.frameskip&&(C=0,w.fitElement(),w.onFrame&&!w.isPreloading&&w.onFrame.call(w,w),h(),u(),++R),q(o)}function a(t){if(void 0===P[t.keyCode])return!0;t.preventDefault();var e=j[P[t.keyCode]];"keydown"===t.type&&0===e.framesDown?(e.wasPressed=e.isDown=!0,e.framesDown=0):"keyup"===t.type&&e.isDown&&(e.wasReleased=!0,e.isDown=!1)}function h(){for(var t in j)j[t].wasPressed&&(j[t].wasPressed=!1),j[t].wasReleased&&(j[t].wasReleased=!1),j[t].isDown?++j[t].framesDown:j[t].framesDown=0}function s(t){var n=t.clientX-(e.clientLeft||0)-(e.offsetLeft||0)+window.scrollX,i=t.clientY-(e.clientTop||0)-(e.offsetTop||0)+window.scrollY;return{fromLeft:Math.floor(n/(e.clientWidth||e.innerWidth)*w.width),fromTop:Math.floor(i/(e.clientHeight||e.innerHeight)*w.height)}}function c(t,e,n,i){n=n||w,i=i||!1,Object.defineProperty(this,"x",{get:function(){return(i?pxMath.clamp(t,n.canvasOffX+0,n.canvasOffX+n.width-1):t)+n.left-n.canvasOffX}}),Object.defineProperty(this,"y",{get:function(){return(i?pxMath.clamp(e,n.canvasOffY+0,n.canvasOffY+n.height-1):e)+n.top-n.canvasOffY}}),Object.defineProperty(this,"inBounds",{get:function(){return i||this.x===this.bounded().x&&this.y===this.bounded().y}}),this.rel=function(n,i){if(-1===["bounded","b","unbounded","u",void 0].indexOf(i))throw new Error('bad value for "bounded" parameter.');return new c(t,e,n,i&&i.startsWith("b"))},function(t){t.bounded=function(){return t.rel(n,"bounded")},t.unbounded=function(){return t.rel(n,"unbounded")}}(this)}function l(t,e){I.cur=I.last=I.start=new c(t,e),I.changed=!0,I.isDown=!0,I.wasStarted=!0}function f(t,e){I.cur=new c(t,e),I.x===I.last.x&&I.y===I.last.y||(I.changed=!0,I.moved=!0,I.isDrag=!0)}function d(){I.changed=!0,I.isDown=!1,I.wasReleased=!0}function u(){I.changed=!1,I.wasStarted=!1,I.moved=!1,I.wasReleased=!1,I.wasInterrupted=!1,I.isDown?I.last=I.cur:(I.cur=I.last=I.start=void 0,I.isMouse=void 0,I.isRightClick=void 0,I.isDrag=!1)}var g=this,w=this;"string"==typeof(e=e||window)&&(e=document.querySelector(e));var p={name:"adapt"},m=e.clientWidth||e.innerWidth,v=e.clientHeight||e.innerWidth,y=3,x=!0,b=null,S="px8",O={},E={x:0,y:0},M={x:0,y:0},P={},j={},I={changed:!1,isDown:!1,isMouse:void 0,isRightClick:void 0,wasStarted:!1,moved:!1,isDrag:!1,wasReleased:!1,wasInterrupted:!1,cur:void 0,last:void 0,start:void 0,x:null,y:null,inBounds:null,rel:null,bounded:null,unbounded:null},C=0,R=0,k=document.createElement("canvas");k.style.display="block",k.style.margin="auto";var D=k.getContext("2d");if(e==window){var H=document.querySelector("body");H.style.padding=0,H.style.margin=0,H.style.overflow="hidden"}(e!==window?e:document.getElementsByTagName("body")[0]).appendChild(k),e!==window&&e.tabIndex<0&&(e.tabIndex=0),n("id",{value:t.assignId(this)}),n("element",function(){return e}),n("canvas",function(){return k}),n("context",function(){return D}),n("canvasOffX",function(){return 0}),n("canvasOffY",function(){return 0}),n("left",function(){return Math.round(-M.x-m*(E.x+1)/2)}),n("top",function(){return Math.round(-M.y-v*(E.y+1)/2)}),n("right",function(){return g.left+m-1}),n("bottom",function(){return g.top+v-1}),n("width",function(){return m}),n("height",function(){return v}),n("drawScale",function(){return y}),n("wasResized",function(){return x}),n("clock",function(){return R}),n("frameskip",{value:0,writable:!0}),this.origin=function(t,e){if(0===arguments.length)return{x:E.x,y:E.y};if(2!==arguments.length)throw new Error("invalid arguments for origin");E={x:t,y:e}},this.offset=function(t,e){if(0===arguments.length)return{x:M.x,y:M.y};if(2!==arguments.length)throw new Error("invalid arguments for offset");M={x:t,y:e}},n("font",{set:function(t){if(!this.hasSheet(t))throw new Error("invalid font: "+t);S=t},get:function(){if(!S)throw new Error("font has not been set.");return S}}),this.mode=function(t){if(0===arguments.length)return p.name;if("adapt"===t)p={name:"adapt"},y=arguments[1]||1,k.style.width="",k.style.height="";else if("fixed"===t)p={name:"fixed"},arguments.length<=2?(y=arguments[1]||1,m=Math.floor((e.clientWidth||e.innerWidth)/y),v=Math.floor((e.clientHeight||e.innerHeight)/y)):(m=arguments[1],v=arguments[2],y=arguments[3]||1),k.style.width="",k.style.height="";else{if("scale-overflow"!==t)throw"scale"===t?new Error("not yet supported."):new Error("unknown mode type.");p={name:"scale-overflow",minWidth:arguments[1]||e.clientWidth||e.innerWidth,minHeight:arguments[2]||e.clientHeight||e.innerHeight},k.style.width="100%",k.style.height="100%"}x=!0,b=null,this.fitElement()},this.setSize=function(t,e){if("fixed"===p.name||"scale"===p.name)m=t,v=e;else{if("scale-overflow"!==p.name)throw new Error("screen mode does not support setSize: "+p.name);p.minWidth=t,p.minHeight=e}this.fitElement()},this.setScale=function(t){if("adapt"!==p.name&&"fixed"!==p.name)throw new Error("screen mode does not support setScale: "+p.name);y=t,this.fitElement()},this.fitElement=function(){var t=e.clientWidth||e.innerWidth,n=e.clientHeight||e.innerHeight;(x=!b||b.w!==t||b.h!==n)&&("adapt"===p.name?i(t,n):"fixed"===p.name?A(t,n):"scale-overflow"===p.name&&r(t,n),e===window&&window.scrollTo(0,0),b={w:t,h:n})},this.fitElement(),this.preload=function(e,n,i,A){if(!n&&0!==n)throw new Error("missing alias");if(O[n])throw new Error("sheet already exists with alias "+n);if(t.globalSheets[n])throw new Error("global sheet already exists with alias "+n);t.hasImage(e)||t.preload(e,this),O[n]=new t.Sheet(n,e,i,A)},this.sheet=function(e){if(O[e])return O[e];if(t.globalSheets[e])return t.globalSheets[e];throw new Error("invalid sheet: "+e)},this.hasSheet=function(e){return!(!O[e]&&!t.globalSheets[e])},n("isPreloading",function(){return t.isPreloading(g)});var W=null;n("onReady",{get:function(){return W},set:function(t){t&&!this.isPreloading?t.call(this):W=t}}),n("onFrame",{writable:!0});var q=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame;q(o),this.bind=function(t){for(var e=1;e<arguments.length;++e){var n=arguments[e];"string"==typeof n&&(n=n.toUpperCase().charCodeAt(0)),P[n]=t}j[t]={wasPressed:!1,wasReleased:!1,isDown:!1,framesDown:0}},this.button=function(t){return j[t]},this.pad=function(){var t;return t=1===arguments.length&&arguments[0]instanceof Array?arguments[0]:Array.prototype.slice.call(arguments),t=t.filter(function(t){return j[t].isDown}),0===t.length?null:t.reduce(function(t,e){return j[e].framesDown<j[t].framesDown?e:t},t[0])},e.addEventListener("keydown",a,!1),e.addEventListener("keyup",a,!1),n("touch",function(){return I}),n("contextMenu",{value:!0,writable:!0}),["x","y","inBounds","rel","bounded","unbounded"].forEach(function(t){Object.defineProperty(I,t,{get:function(){if(void 0===I.cur)throw new Error("No touch events happening.");return I.cur[t]}})}),e.addEventListener("mousedown",function(t){if(!I.isDown){var e=s(t);l(e.fromLeft,e.fromTop),I.isMouse=!0,I.isRightClick=2===t.button}},!1),window.addEventListener("mousemove",function(t){if(I.isMouse){var e=s(t);f(e.fromLeft,e.fromTop)}},!1),window.addEventListener("mouseup",function(t){I.isMouse&&d()},!1);var Y=void 0;e.addEventListener("touchstart",function(t){if(t.preventDefault(),!I.isDown){var e=s(t.changedTouches[0]);l(e.fromLeft,e.fromTop),I.isMouse=!1,Y=t.changedTouches[0].identifier}},!1),e.addEventListener("touchmove",function(t){if(t.preventDefault(),I.isDown&&!I.isMouse){var e=Array.prototype.find.call(t.changedTouches,function(t){return t.identifier===Y});if(e){var n=s(e);f(n.fromLeft,n.fromTop)}}},!1),e.addEventListener("touchend",function(t){if(t.preventDefault(),I.isDown&&!I.isMouse){if(Array.prototype.find.call(t.changedTouches,function(t){return t.identifier===Y}))if(0===t.targetTouches.length)d(),Y=null;else{var e=t.targetTouches[t.targetTouches.length-1];Y=e.identifier,f(e)}}},!1),e.addEventListener("contextmenu",function(t){w.contextMenu||t.preventDefault()}),n("hasFocus",function(){return document.hasFocus()&&document.activeElement===e})};pxcan.Panel=function(t,e,n,i,A,r,o){if(-1===[5,7].indexOf(arguments.length))throw new Error("invalid number of arguments.");5===arguments.length&&(r=t.origin().x,o=t.origin().y);var a=this,h=null,s=t.origin(),c=t.offset(),l=t.screen||t;this.canvasOffX=Math.round(t.canvasOffX+e+t.width*(t.origin().x+1)/2-i*(r+1)/2),this.canvasOffY=Math.round(t.canvasOffY+n+t.height*(t.origin().y+1)/2-A*(o+1)/2);var f=Math.round(i),d=Math.round(A);["element","canvas","context","drawScale","sheet"].forEach(function(t){Object.defineProperty(a,t,{get:function(){return l[t]}})}),Object.defineProperty(this,"screen",{get:function(){return l}}),Object.defineProperty(this,"left",{get:function(){return Math.round(c.x-f*(s.x+1)/2)}}),Object.defineProperty(this,"top",{get:function(){return Math.round(c.y-d*(s.y+1)/2)}}),Object.defineProperty(this,"right",{get:function(){return this.left+f-1}}),Object.defineProperty(this,"bottom",{get:function(){return this.top+d-1}}),Object.defineProperty(this,"width",{get:function(){return f}}),Object.defineProperty(this,"height",{get:function(){return d}}),Object.defineProperty(this,"font",{set:function(t){if(!this.hasSheet(t))throw new Error("invalid font: "+t);h=t},get:function(){return h||t.font}}),this.origin=function(t,e){if(0===arguments.length)return{x:s.x,y:s.y};if(2!==arguments.length)throw new Error("invalid arguments for origin");s={x:t,y:e}},this.offset=function(t,e){if(0===arguments.length)return{x:c.x,y:c.y};if(2!==arguments.length)throw new Error("invalid arguments for offset");c={x:t,y:e}}},pxcan.prototype.panel=pxcan.Panel.prototype.panel=function(t,e,n,i,A,r){if(4===arguments.length)return new pxcan.Panel(this,t,e,n,i);if(6===arguments.length)return new pxcan.Panel(this,t,e,n,i,A,r);throw new Error("invalid number of arguments.")},pxcan.prototype.setBackground=function(t){(this.element!==window?this.element:document.getElementsByTagName("body")[0]).style.background=t},pxcan.prototype.toCanvasCoords=pxcan.Panel.prototype.toCanvasCoords=function(t,e,n,i,A,r){if(6!==arguments.length)throw new Error("toCanvasCoords requires 6 arguments");void 0!==A&&null!==A||(A=this.origin().x),void 0!==r&&null!==r||(r=this.origin().y);var o=Math.round(this.canvasOffX+t+this.offset().x+this.width*(this.origin().x+1)/2-(n||0)*(A+1)/2),a=Math.round(this.canvasOffY+e+this.offset().y+this.height*(this.origin().y+1)/2-(i||0)*(r+1)/2),h=Math.max(0,this.canvasOffX-o,-o),s=Math.max(0,this.canvasOffY-a,-a),c=Math.max(0,o+n-(this.canvasOffX+this.width),o+n-(this.screen||this).width),l=Math.max(0,a+i-(this.canvasOffY+this.height),a+i-(this.screen||this).height);return h+c>=n||s+l>=i?null:{x:o+h,y:a+s,width:n-h-c,height:i-s-l,lcut:h,tcut:s,rcut:c,bcut:l}},pxcan.prototype.clear=pxcan.Panel.prototype.clear=function(t,e,n,i,A,r){if(-1===[0,4,6].indexOf(arguments.length))throw new Error("bad arguments for clear");if(0===arguments.length)return void(this instanceof pxcan?this.context.clearRect(0,0,this.canvas.width,this.canvas.height):this.context.clearRect(this.canvasOffX*this.drawScale,this.canvasOffY*this.drawScale,this.width*this.drawScale,this.height*this.drawScale));var o=this.toCanvasCoords(t,e,n,i,A,r);o&&this.context.clearRect(o.x*this.drawScale,o.y*this.drawScale,o.width*this.drawScale,o.height*this.drawScale)},pxcan.prototype.reset=function(){this.clear(),this.origin(0,0),this.offset(0,0)},pxcan.prototype.fill=pxcan.Panel.prototype.fill=function(t,e,n,i,A,r,o){if(-1===[1,5,7].indexOf(arguments.length))throw new Error("bad arguments for fill");var a=this.context.fillStyle;if(this.context.fillStyle=t,1===arguments.length)return this instanceof pxcan?this.context.fillRect(0,0,this.canvas.width,this.canvas.height):this.context.fillRect(this.canvasOffX*this.drawScale,this.canvasOffY*this.drawScale,this.width*this.drawScale,this.height*this.drawScale),void(this.context.fillStyle=a);var h=this.toCanvasCoords(e,n,i,A,r,o);h&&(this.context.fillRect(h.x*this.drawScale,h.y*this.drawScale,h.width*this.drawScale,h.height*this.drawScale),this.context.fillStyle=a)},pxcan.prototype.blit=pxcan.Panel.prototype.blit=function(t){var e=arguments;if(-1===[3,4,5,6,7,8].indexOf(arguments.length))throw new Error("bad arguments for blit");var n,i,A=null,r=null,o="",a=void 0,h=void 0;!function(){var t=void 0;"number"==typeof e[e.length-3]&&"number"==typeof e[e.length-4]?(n=e[e.length-4],i=e[e.length-3],a=e[e.length-2],h=e[e.length-1],t=e.length-4):(n=e[e.length-2],i=e[e.length-1],t=e.length-2);var s=1;s<t&&Array.isArray(e[s])&&(A=e[s],++s),s<t&&-1!==["number","object"].indexOf(_typeof(e[s]))&&(r=e[s],++s),s<t&&"string"==typeof e[s]&&(o=e[s],++s)}();var s=this.sheet(t);if(!s)throw new Error("unknown sheet: "+t);var c=A&&A.length>0?pxcan.recolorImage(s.src,A):s.src,l=null!==r?s.getSprite(r):s,f=!1,d=!1,u=!1;o.replace("90","c").replace("180","xy").replace("270","cxy").split("").forEach(function(t){if("x"===t||"h"===t)f=!f;else if("y"===t||"v"===t)d=!d;else if("c"===t){u&&(f=!f,d=!d),u=!u;var e=f;f=d,d=e}});var g=this.toCanvasCoords(n,i,u?l.height:l.width,u?l.width:l.height,a,h);g&&((f||d||u)&&(this.context.save(),this.context.setTransform(+!u&&(f?-1:1),+u&&(d?-1:1),+u&&(f?1:-1),+!u&&(d?-1:1),this.canvas.width*+f,this.canvas.height*+d)),u?this.context.drawImage(pxcan.scaledImage(c,this.drawScale),(l.left+(d?g.bcut:g.tcut))*this.drawScale,(l.top+(f?g.lcut:g.rcut))*this.drawScale,g.height*this.drawScale,g.width*this.drawScale,this.canvas.height*+d+(g.y*(d?-1:1)-g.height*+d)*this.drawScale,-this.canvas.width*+f-(g.x*(f?-1:1)+g.width*+!f)*this.drawScale,g.height*this.drawScale,g.width*this.drawScale):this.context.drawImage(pxcan.scaledImage(c,this.drawScale),(l.left+(f?g.rcut:g.lcut))*this.drawScale,(l.top+(d?g.bcut:g.tcut))*this.drawScale,g.width*this.drawScale,g.height*this.drawScale,this.canvas.width*+f+(g.x*(f?-1:1)-g.width*+f)*this.drawScale,this.canvas.height*+d+(g.y*(d?-1:1)-g.height*+d)*this.drawScale,g.width*this.drawScale,g.height*this.drawScale),(u||f||d)&&this.context.restore())},pxcan.prototype.write=pxcan.Panel.prototype.write=function(t){if(-1===[3,4,5,6].indexOf(arguments.length))throw new Error("bad arguments for write");if(void 0===t||null===t)throw new Error("text is "+t);"string"!=typeof t&&(t=t.toString());var e,n,i,A,r,o,a="number"==typeof arguments[1]?1:2;e="number"==typeof arguments[1]?[]:[arguments[1]],n=arguments[a],i=arguments[a+1],arguments.length>=a+3?(A=arguments[a+2],r=arguments[a+3]):(A=this.origin().x,r=this.origin().y),o=-1!==[a+3,a+5].indexOf(arguments.length)?arguments[arguments.length-1]:0;var h=this.sheet(this.font);if("string"==typeof o)if("left"===o)o=0;else if("center"===o)o=.5;else{if("right"!==o)throw new Error("unknown text alignment: "+o);o=1}for(var s=t.split("\n"),c=0,l=0;l<s.length;++l)c=Math.max(s[l].length,c);for(var f=h.spriteWidth,d=h.spriteHeight,u=Math.round(n-(c-1)*f*((A+1)/2)),g=Math.round(i-(s.length-1)*d*((r+1)/2)),w=0;w<s.length;++w)for(var p=Math.round((c-s[w].length)*o*f),m=0;m<s[w].length;++m)this.blit(this.font,e,s[w].charCodeAt(m)-32,u+p+m*f,g+w*d,A,r)},pxcan.prototype.border=pxcan.Panel.prototype.border=function(){var t="pxborder",e=null;arguments.length>0&&("string"==typeof arguments[0]&&(t=arguments[0]),Array.isArray(arguments[arguments.length-1])&&(e=arguments[arguments.length-1]));var n=this.origin(),i=this.offset();this.origin(-1,-1),this.offset(0,0);for(var A=this.sheet(t).spriteWidth,r=A;r<this.width-A;r+=A)this.blit(t,e,{col:1,row:0},r,0,-1,-1),this.blit(t,e,{col:1,row:2},r,this.height,-1,1);for(var o=this.sheet(t).spriteHeight,a=o;a<this.height-o;a+=o)this.blit(t,e,{col:0,row:1},0,a,-1,-1),this.blit(t,e,{col:2,row:1},this.width,a,1,-1);this.blit(t,e,{col:0,row:0},0,0,-1,-1),this.blit(t,e,{col:2,row:0},this.width,0,1,-1),this.blit(t,e,{col:0,row:2},0,this.height,-1,1),this.blit(t,e,{col:2,row:2},this.width,this.height,1,1),this.origin(n.x,n.y),this.offset(i.x,i.y)},function(){var t=[],e={},n={},i=0,A={};pxcan.assignId=function(){var e=-1;return function(i){return t.push(i),n[e+1]=0,++e}}(),pxcan.isPreloading=function(t){return!!n[t.id]||i>0},pxcan.preload=function(r,o){function a(){if(A[r]={image:s,scaledImages:{1:document.createElement("canvas")}},A[r].scaledImages[1].width=s.width,A[r].scaledImages[1].height=s.height,A[r].scaledImages[1].getContext("2d").drawImage(s,0,0),h?--i:e[r].forEach(function(t){return--n[t.id]}),!(i>0||e[r]&&e[r].every(function(t){return n[t.id]}))){(h?t:e[r]).filter(function(t){return!n[t.id]}).forEach(function(t){t.onReady&&t.onReady.call(t),t.onReady=null}),delete e[r]}}var h=!o;if(!r)throw new Error("missing source image");if(A[r])return void console.log("note: "+r+" was already preloaded.");if(e[r])return h?void console.log("note: "+r+" was already requested to be preloaded"):e[r].indexOf(o)>=0?void console.log("note: "+r+" was already requested to be preloaded by this pxcan"):(console.log("note: "+r+" was already requested to be preloaded by a different pxcan"),e[r].push(o),void++n[o.id]);h?++i:(e[r]=[o],++n[o.id]);var s=new Image;s.onload=a,s.onerror=function(){throw new Error("Failed to load image "+r)},s.src=r},pxcan.hasImage=function(t){return!!A[t]},pxcan.image=function(t){if(!pxcan.hasImage(t))throw new Error("invalid image src: "+t);return A[t].image},pxcan.recolorImage=function(t,e){if(!A[t])throw new Error("invalid image src: "+t);var n=t+"@"+e.join(",");if(A[n])return n;var i=document.createElement("canvas"),r=A[t].scaledImages[1];i.width=r.width,i.height=r.height;var o=i.getContext("2d"),a=new Uint32Array(r.getContext("2d").getImageData(0,0,r.width,r.height).data.buffer),h=[],s=Array.prototype.map.call(a,function(t){if(0==(4278190080&t))return 0;var e=h.indexOf(t);return-1!==e?e+1:(h.push(t),h.length)});h=h.map(function(t,e){return{oldIdx:e,brightness:(255&t)+((65280&t)>>8)+((16711680&t)>>16)}}).sort(function(t,e){return t.brightness-e.brightness}),h.forEach(function(t,e){return t.bIdx=e+1}),h.sort(function(t,e){return t.oldIdx-e.oldIdx}),s=Array.prototype.map.call(s,function(t){return 0===t?0:h[t-1].bIdx});for(var c=0,l=0;l<r.height;++l)for(var f=0;f<r.width;++f)0!==s[c]&&(o.fillStyle=e[s[c]-1],o.fillRect(f,l,1,1)),++c;return A[n]={scaledImages:{1:i}},n},pxcan.scaledImage=function(t,e){if(!A[t])throw new Error("invalid image src: "+t);if(A[t].scaledImages[e])return A[t].scaledImages[e];var n=document.createElement("canvas"),i=A[t].scaledImages[1];n.width=i.width*e,n.height=i.height*e;for(var r=n.getContext("2d"),o=i.getContext("2d").getImageData(0,0,i.width,i.height).data,a=0,h=0;h<i.height;++h)for(var s=0;s<i.width;++s)r.fillStyle="rgba("+o[a]+","+o[a+1]+","+o[a+2]+","+o[a+3]+")",r.fillRect(s*e,h*e,e,e),a+=4;return A[t].scaledImages[e]=n,n}}(),pxcan.Sheet=function(t,e,n,i){Object.defineProperty(this,"alias",{get:function(){return t}}),Object.defineProperty(this,"img",{get:function(){return pxcan.image(e)}}),Object.defineProperty(this,"src",{get:function(){return e}}),Object.defineProperty(this,"left",{get:function(){return 0}}),Object.defineProperty(this,"top",{get:function(){return 0}}),Object.defineProperty(this,"width",{get:function(){return this.img.width}}),Object.defineProperty(this,"height",{get:function(){return this.img.height}}),Object.defineProperty(this,"spriteWidth",{get:function(){return n||this.img.width}}),Object.defineProperty(this,"spriteHeight",{get:function(){return i||this.img.height}}),Object.defineProperty(this,"numCols",{get:function(){return Math.floor(this.img.width/n)}}),Object.defineProperty(this,"numRows",{get:function(){return Math.floor(this.img.height/i)}}),Object.defineProperty(this,"numSprites",{get:function(){return this.numCols*this.numRows}})},pxcan.Sheet.prototype.scaledImage=function(t){return pxcan.scaledImage(this.src,t)},pxcan.Sheet.prototype.getSprite=function(t){return new pxcan.Sprite(this,t)},pxcan.Sprite=function(t,e){if(void 0===e||null===e)throw new Error("bad frame while constructing sprite");"number"==typeof e&&e%1==0&&(e={col:e%t.numCols,row:Math.floor(e/t.numCols)});var n=void 0!==e.x?e.x:e.col?e.col*t.spriteWidth:0,i=void 0!==e.y?e.y:e.row?e.row*t.spriteHeight:0,A=void 0!==e.width?e.width:void 0!==e.col?t.spriteWidth:t.width-n,r=void 0!==e.height?e.height:void 0!==e.row?t.spriteHeight:t.height-i;Object.defineProperty(this,"sheet",{get:function(){return t}}),Object.defineProperty(this,"img",{get:function(){return t.img}}),Object.defineProperty(this,"left",{get:function(){return n}}),Object.defineProperty(this,"top",{get:function(){return i}}),Object.defineProperty(this,"width",{get:function(){return A}}),Object.defineProperty(this,"height",{get:function(){return r}})},pxcan.Sprite.prototype.scaledImage=function(t){return pxcan.scaledImage(this.sheet.src,t)},pxcan.globalSheets={},pxcan._registerGlobalSheet=function(t,e){pxcan.preload(t);var n=e.split(".")[0],i=e.split(".")[1];pxcan.globalSheets[n]=new pxcan.Sheet(n,t,+i.split("x")[0],+i.split("x")[1])};var pxMath={mid:function(){for(var t=[],e=0;e<arguments.length;++e)t.push(+arguments[e]);return t.sort(function(t,e){return t-e}),t.length%2==1?t[Math.floor(t.length/2)]:(t[Math.floor(t.length/2)]+t[Math.floor(t.length/2)-1])/2},clamp:function(t,e,n){return 2===arguments.length&&(n=arguments[1],e=-arguments[1]),pxMath.mid(e,t,n)}};pxcan._registerGlobalSheet("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAABICAMAAACz1EcFAAADAFBMVEUAAAAiIDRFKDxmOTGPVjvfcSbZoGbuw5r78jaZ5VBqvjA3lG5LaS9SSyQyPDk/P3QwYIJbbuFjm/9fzeTL2/z///+brbeEfodpampZVlJ2QoqsMjLZV2PXe7qPl0qKbzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQfngCAAABAHRSTlMA////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Cpf0PAAAAZ1JREFUSImllgF2wzAIQ7kE97/q+mIDX9hu6rfsLbMbLCQQ6czuLvfP7+dn3t3Hn7F6nvZAf67nyDjncxGBemTgmGAtHArcZnJ5Xosk9mz8jPlVsafeQ0iwh7htsAYWvZClClzLsIGto71crcC3uiEGsqKE0ihnhXnLrPNI9ikghy+8ihDdlBoBKr0GWMGxpLPY7E71S0ijQj4MSURfILBqMk+IW45nl/1+saVz61pbk6GMDrMSSttwWkqW1YhA9cweMUmxucKxZPwuOl8IDmwz2bKRwrcCvZyQ8bFVtzgso4hNugZGGtkas962eu11G9xMzZuwlfytMwxUPZEaZjkGmsIasP1StDgs3z3BhuOCbpJebiSSLZaGamoXHNPoxlF8lNvKeevwZcUNXDDRYQq1L/h3U8gcxeFzIClQ2Dn1y/t4r5pfHweItVHBckcHiKlhGUX0q+neDJfpXPfAO9VfStE+q7FPA7y9AMqtSZOBQMy8qkfmOuuCL78ayn/KrtSiWOoKT+ct28V/ydrw4aHDyjBzIRpgA8cBu3L8A/JAROlh3CQ9AAAAAElFTkSuQmCC","px6.5x6"),pxcan._registerGlobalSheet("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABgCAYAAACtxXToAAAFZUlEQVR4nO1c7Y7jMAh0V33/V8792fQIHWAGO2lO15GqftgGm9gwkOw+tm0b/zN+hL7b76tqi/pt7j2SU+ll5pC1H/ooBpiBX3xloGyRj+T3RzIW4ql0LvAIPu/fN/dusZl+mVx1HmW7ugMi4dby8lUwcrtX3777z0jP3x8ucoJISWTMaDfYHWTbN/c5k/0GdgdUDqbCI3j38qvFZ/ND4+qJkTugrUBAtchq7I7Iz0AgA2RXAf3+r+FgHH8EGG+sxnHbdjvWhXxAdoUrxxV9vwvejsaPa1QEWVjv7JUgJncbA60kQl0wvgUZvKPnbZw1gEJgshjtvXA7Rif6lgH5gI6TQ9SXxezimCMVhkVvgMzTM1ewassSmY/gKip8W+w+gHEy2Q6oxivyfTt77FrjnwMvDIWyCFHYQ8kKard96CwOzCHql14Mlgd0zz3TzviAzb18G6MH9kVhcMYhscekOiIojNq2rKjC6H/BE6FOMcMryIome79ogau4QnYhy4rQDMuiLS/KPg17GJzx4ozjYqlslYpH49tR7MsDft9XWPjOCOfP8AAmzvvxSLkSptj+zBhURH3N/w7p8I4u04yiC+r7hq4TLAWLWFVvlHkIS4VZWqxOysqPriDSqeYq4Vj1CETGyhSz5Moawctjq0UyZX8CxahzxznZseyYM6tFXx6A0KkH+HbGQWZ9Og44G4/khPp3JxgVOdF3JtwgnuD7RBOOjkw37U71P4OOXsCKkKf4gTPqhKETXKV8xlGq8pEONgwe+nkDbOZdjf1sPt7FbOXJ9nutx1eEGOEzBRM2HzhrB0EfEBEVZRJehicxdmdF8tmkSp0f0v8a++UBg8sFxuCdkG9H6Wj23YNJ17P2bG7SU2IVN2e4+0zWh44Ras907q9X36selLToOjgmRMvnmSFCq3CWd9+BkroSdgfYLaJAUThr5FVc4IUrj0CVvFjMGEoyAlsQ8ROy2znjAB5Z5eesI5jWO748YPTy+dl6AEOto/QY8Yh2e5QLqERjZjxLiE7BJ3jAGBcvMkPEA1bWA5ii6wwQQaLls+mwRVWyqnxCVv+fRebRoU7mCFS1QNTfTuTWYYblAd4I9jdmrJLLo+1cjbd9ojbY50oeUIXC1YUQCqge0ImzCNFE1QWwFLrlV35GvjgGD/fqICrLsahqBSF2J8icoZH08RO5Ms6zOxIielg6U8RORMXMLvCskkb0N0ORgkjJR2hsoFOaw24AxN1ZrFz8rC+Q4bPBLF+vwIYr1WCzBkl39bce8Ps+k6isPv8deW2y1C2JrSicrlqgemPkkD0+3Y8RZrK5VWk2S51RX/vbYZ3Kn82xPMBPIPuNla3ol3SjByQqwQxXUHeIUiOMkOUeofHYktgKB7cy3Kiywlyl6wSRguzKoWSlclL++4pI9Tb+ywMGH3e7mSAj/6yCaQnlWeGuE2JlR1sxjOGmHR2bSMahveMDmNIVc7U7laFt5EZA31Mewd4XULK0OxVLSjC3xlbiVosfY82tMWVn+HCmYrkBlX+kZD/7RajHIxs/a6RM51se89/zgE/dHUZYfeUp/Bildot4+Da/ZZXx6kLRcUH6W+2+KIrOqA1fUTjMMkY/HiUl2YRPBfvX44z3tbV5VEbPrn5Vdq/QricwRGhFqXqmosTI9kezVRNUS0wsOos9i4i9YeZvh9lJoh1U5QrqDmTqEbDPlwd8QGcVKtVxU9h5QEZFmTjLxvmZjHDm3qXnKi85d3lAYhbVRbPn/zBHdGNkphaQGbAyruJQfcEjK36gecgVoSoMMorR5FUZqI9Kog597vZ8wOWwydAYeb5uz1l0BSsn2DWyHdOlyjBP+QNcO0/NfGhMCAAAAABJRU5ErkJggg==","px8.8x8"),pxcan._registerGlobalSheet("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAhElEQVRIie2WwQrAIAxDU/H/fzk7CdHVwdYWdjCXipQX04NqJIlCdVkbAG5q2EAh3NSQgUJCJxaeAaAm+DqONaEpp22a3mgCrrwmTVG5jIwEj8pM4HKa15WpY3AM/m3AagOrNrglyLouJp4aZF1400u4vmhZJmMa7IiPxvsojH1Y9bflAvhRIjH91XRBAAAAAElFTkSuQmCC","pxborder.8x8"),pxcan.random=function(){function t(t){var e,n,i,A=0;if(0==t.length)return A;for(e=0,i=t.length;e<i;e++)n=t.charCodeAt(e),A=(A<<5)-A+n,A|=0;return A}function e(e){if("number"==typeof e)return e;if("string"==typeof e)return t(e);throw new Error("not sure what to do with seed: "+e)}function n(t){var i=e(t),A=function(){var t=1e4*Math.sin(i++);if(t-=Math.floor(t),0===arguments.length)return t;if(1===arguments.length&&arguments[0]instanceof Array)return arguments[0][Math.floor(t*arguments[0].length)];if(1===arguments.length)return Math.floor(t*arguments[0]);if(2===arguments.length)return Math.floor(t*(arguments[1]+1-arguments[0]))+arguments[0];throw new Error("invalid arguments for random generator.")};return A.seed=function(t){i=e(t)},A.create=function(t){return n(void 0!==t?t:A())},A}return n(Math.random())}(),pxcan.wrapString=function(t,e,n){if(!t)return t;var i=".{1,"+e+"}(\\s|$)|.{"+e+"}|.+$",A=t.match(RegExp(i,"g"));n&&(A=A.slice(0,n));for(var r=0;r<A.length;++r)A[r]=A[r].trim();return A.join("\n")};