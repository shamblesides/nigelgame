"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},pxcan=function a(b){function c(a,b){"function"==typeof b?Object.defineProperty(q,a,{get:b}):Object.defineProperty(q,a,b)}function d(a,b){G.width=(s=Math.floor(a/u))*u,G.height=(t=Math.floor(b/u))*u}function e(){G.width!==s*u&&(G.width=s*u),G.height!==t*u&&(G.height=t*u)}function f(a,b){r.minWidth*b===r.minHeight*a?(s=r.minWidth,t=r.minHeight):r.minWidth*b<r.minHeight*a?(s=Math.floor(a/b*r.minHeight),t=r.minHeight):(s=r.minWidth,t=Math.floor(b/a*r.minWidth)),u=Math.floor(Math.min(b/t,a/s)),1>u&&(u=1),G.width=s*u,G.height=t*u}function g(){++E,E>q.frameskip&&(E=0,q.fitElement(),q.onFrame&&!q.isPreloading&&q.onFrame.call(q,q),i(),o(),++F),K(g)}function h(a){if(void 0===B[a.keyCode])return!0;a.preventDefault();var b=C[B[a.keyCode]];"keydown"===a.type&&0===b.framesDown?(b.wasPressed=b.isDown=!0,b.framesDown=0):"keyup"===a.type&&b.isDown&&(b.wasReleased=!0,b.isDown=!1)}function i(){for(var a in C)C[a].wasPressed&&(C[a].wasPressed=!1),C[a].wasReleased&&(C[a].wasReleased=!1),C[a].isDown?++C[a].framesDown:C[a].framesDown=0}function j(a){var c=a.clientX-(b.clientLeft||0)-(b.offsetLeft||0)+window.scrollX,d=a.clientY-(b.clientTop||0)-(b.offsetTop||0)+window.scrollY;return{fromLeft:Math.floor(c/(b.clientWidth||b.innerWidth)*q.width),fromTop:Math.floor(d/(b.clientHeight||b.innerHeight)*q.height)}}function k(a,b,c,d){c=c||q,d=d||!1,Object.defineProperty(this,"x",{get:function(){return(d?pxMath.clamp(a,c.canvasOffX+0,c.canvasOffX+c.width-1):a)+c.left-c.canvasOffX}}),Object.defineProperty(this,"y",{get:function(){return(d?pxMath.clamp(b,c.canvasOffY+0,c.canvasOffY+c.height-1):b)+c.top-c.canvasOffY}}),Object.defineProperty(this,"inBounds",{get:function(){return d||this.x===this.bounded().x&&this.y===this.bounded().y}}),this.rel=function(c,d){if(-1===["bounded","b","unbounded","u",void 0].indexOf(d))throw new Error('bad value for "bounded" parameter.');return new k(a,b,c,d&&d.startsWith("b"))},function(a){a.bounded=function(){return a.rel(c,"bounded")},a.unbounded=function(){return a.rel(c,"unbounded")}}(this)}function l(a,b){D.cur=D.start=new k(a,b),D.changed=!0,D.isDown=!0,D.wasStarted=!0}function m(a,b){D.cur=new k(a,b),D.last&&D.x===D.last.x&&D.y===D.last.y||(D.changed=!0,D.moved=!0,D.isDrag=!0)}function n(){D.changed=!0,D.isDown=!1,D.wasReleased=!0}function o(){D.changed=!1,D.wasStarted=!1,D.moved=!1,D.wasReleased=!1,D.wasInterrupted=!1,D.isDown?D.last=D.cur:(D.cur=D.last=D.start=void 0,D.isMouse=void 0,D.isRightClick=void 0,D.isDrag=!1)}var p=this,q=this;b=b||window,"string"==typeof b&&(b=document.querySelector(b));var r={name:"adapt"},s=b.clientWidth||b.innerWidth,t=b.clientHeight||b.innerWidth,u=3,v=!0,w=null,x="px8",y={},z={x:0,y:0},A={x:0,y:0},B={},C={},D={changed:!1,isDown:!1,isMouse:void 0,isRightClick:void 0,wasStarted:!1,moved:!1,isDrag:!1,wasReleased:!1,wasInterrupted:!1,cur:void 0,last:void 0,start:void 0,x:null,y:null,inBounds:null,rel:null,bounded:null,unbounded:null},E=0,F=0,G=document.createElement("canvas");G.style.display="block",G.style.margin="auto";var H=G.getContext("2d");if(b==window){var I=document.querySelector("body");I.style.padding=0,I.style.margin=0,I.style.overflow="hidden"}(b!==window?b:document.getElementsByTagName("body")[0]).appendChild(G),b!==window&&b.tabIndex<0&&(b.tabIndex=0),c("id",{value:a.assignId(this)}),c("element",function(){return b}),c("canvas",function(){return G}),c("context",function(){return H}),c("canvasOffX",function(){return 0}),c("canvasOffY",function(){return 0}),c("left",function(){return Math.round(-A.x-s*(z.x+1)/2)}),c("top",function(){return Math.round(-A.y-t*(z.y+1)/2)}),c("right",function(){return p.left+s-1}),c("bottom",function(){return p.top+t-1}),c("width",function(){return s}),c("height",function(){return t}),c("drawScale",function(){return u}),c("wasResized",function(){return v}),c("clock",function(){return F}),c("frameskip",{value:0,writable:!0}),this.origin=function(a,b){if(0===arguments.length)return{x:z.x,y:z.y};if(2!==arguments.length)throw new Error("invalid arguments for origin");z={x:a,y:b}},this.offset=function(a,b){if(0===arguments.length)return{x:A.x,y:A.y};if(2!==arguments.length)throw new Error("invalid arguments for offset");A={x:a,y:b}},c("font",{set:function(a){if(!this.hasSheet(a))throw new Error("invalid font: "+a);x=a},get:function(){if(!x)throw new Error("font has not been set.");return x}}),this.mode=function(a){if(0===arguments.length)return r.name;if("adapt"===a)r={name:"adapt"},u=arguments[1]||1,G.style.width="",G.style.height="";else if("fixed"===a)r={name:"fixed"},arguments.length<=2?(u=arguments[1]||1,s=Math.floor((b.clientWidth||b.innerWidth)/u),t=Math.floor((b.clientHeight||b.innerHeight)/u)):(s=arguments[1],t=arguments[2],u=arguments[3]||1),G.style.width="",G.style.height="";else{if("scale-overflow"!==a)throw new Error("scale"===a?"not yet supported.":"unknown mode type.");r={name:"scale-overflow",minWidth:arguments[1]||b.clientWidth||b.innerWidth,minHeight:arguments[2]||b.clientHeight||b.innerHeight},G.style.width="100%",G.style.height="100%"}v=!0,w=null,this.fitElement()},this.setSize=function(a,b){if("fixed"===r.name||"scale"===r.name)s=a,t=b;else{if("scale-overflow"!==r.name)throw new Error("screen mode does not support setSize: "+r.name);r.minWidth=a,r.minHeight=b}this.fitElement()},this.setScale=function(a){if("adapt"!==r.name&&"fixed"!==r.name)throw new Error("screen mode does not support setScale: "+r.name);u=a,this.fitElement()},this.fitElement=function(){var a=b.clientWidth||b.innerWidth,c=b.clientHeight||b.innerHeight;v=!w||w.w!==a||w.h!==c,v&&("adapt"===r.name?d(a,c):"fixed"===r.name?e(a,c):"scale-overflow"===r.name&&f(a,c),b===window&&window.scrollTo(0,0),w={w:a,h:c})},this.fitElement(),this.preload=function(b,c,d,e){if(!c&&0!==c)throw new Error("missing alias");if(y[c])throw new Error("sheet already exists with alias "+c);if(a.globalSheets[c])throw new Error("global sheet already exists with alias "+c);a.hasImage(b)||a.preload(b,this),y[c]=new a.Sheet(c,b,d,e)},this.sheet=function(b){if(y[b])return y[b];if(a.globalSheets[b])return a.globalSheets[b];throw new Error("invalid sheet: "+b)},this.hasSheet=function(b){return!(!y[b]&&!a.globalSheets[b])},c("isPreloading",function(){return a.isPreloading(p)});var J=null;c("onReady",{get:function(){return J},set:function(a){a&&!this.isPreloading?a.call(this):J=a}}),c("onFrame",{writable:!0});var K=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame;K(g),this.bind=function(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];"string"==typeof c&&(c=c.toUpperCase().charCodeAt(0)),B[c]=a}C[a]={wasPressed:!1,wasReleased:!1,isDown:!1,framesDown:0}},this.button=function(a){return C[a]},this.pad=function(){var a;return a=1===arguments.length&&arguments[0]instanceof Array?arguments[0]:Array.prototype.slice.call(arguments),a=a.filter(function(a){return C[a].isDown}),0===a.length?null:a.reduce(function(a,b){return C[b].framesDown<C[a].framesDown?b:a},a[0])},b.addEventListener("keydown",h,!1),b.addEventListener("keyup",h,!1),c("touch",function(){return D}),c("contextMenu",{value:!0,writable:!0}),["x","y","inBounds","rel","bounded","unbounded"].forEach(function(a){Object.defineProperty(D,a,{get:function(){if(void 0===D.cur)throw new Error("No touch events happening.");return D.cur[a]}})}),b.addEventListener("mousedown",function(a){if(!D.isDown){var b=j(a);l(b.fromLeft,b.fromTop),D.isMouse=!0,D.isRightClick=2===a.button}},!1),window.addEventListener("mousemove",function(a){if(D.isMouse){var b=j(a);m(b.fromLeft,b.fromTop)}},!1),window.addEventListener("mouseup",function(){D.isMouse&&n()},!1);var L=void 0;b.addEventListener("touchstart",function(a){if(a.preventDefault(),!D.isDown){var b=j(a.changedTouches[0]);l(b.fromLeft,b.fromTop),D.isMouse=!1,L=a.changedTouches[0].identifier}},!1),b.addEventListener("touchmove",function(a){if(a.preventDefault(),D.isDown&&!D.isMouse){var b=Array.prototype.find.call(a.changedTouches,function(a){return a.identifier===L});if(b){var c=j(b);m(c.fromLeft,c.fromTop)}}},!1),b.addEventListener("touchend",function(a){if(a.preventDefault(),D.isDown&&!D.isMouse){var b=Array.prototype.find.call(a.changedTouches,function(a){return a.identifier===L});if(b)if(0===a.targetTouches.length)n(),L=null;else{var c=a.targetTouches[a.targetTouches.length-1];L=c.identifier,m(c)}}},!1),b.addEventListener("contextmenu",function(a){q.contextMenu||a.preventDefault()}),c("hasFocus",function(){return document.hasFocus()&&document.activeElement===b})};pxcan.Panel=function(a,b,c,d,e,f,g){if(-1===[5,7].indexOf(arguments.length))throw new Error("invalid number of arguments.");5===arguments.length&&(f=a.origin().x,g=a.origin().y);var h=this,i=null,j=a.origin(),k=a.offset(),l=a.screen||a;this.canvasOffX=Math.round(a.canvasOffX+b+a.width*(a.origin().x+1)/2-d*(f+1)/2),this.canvasOffY=Math.round(a.canvasOffY+c+a.height*(a.origin().y+1)/2-e*(g+1)/2);var m=Math.round(d),n=Math.round(e);["element","canvas","context","drawScale","sheet"].forEach(function(a){Object.defineProperty(h,a,{get:function(){return l[a]}})}),Object.defineProperty(this,"screen",{get:function(){return l}}),Object.defineProperty(this,"left",{get:function(){return Math.round(k.x-m*(j.x+1)/2)}}),Object.defineProperty(this,"top",{get:function(){return Math.round(k.y-n*(j.y+1)/2)}}),Object.defineProperty(this,"right",{get:function(){return this.left+m-1}}),Object.defineProperty(this,"bottom",{get:function(){return this.top+n-1}}),Object.defineProperty(this,"width",{get:function(){return m}}),Object.defineProperty(this,"height",{get:function(){return n}}),Object.defineProperty(this,"font",{set:function(a){if(!this.hasSheet(a))throw new Error("invalid font: "+a);i=a},get:function(){return i||a.font}}),this.origin=function(a,b){if(0===arguments.length)return{x:j.x,y:j.y};if(2!==arguments.length)throw new Error("invalid arguments for origin");j={x:a,y:b}},this.offset=function(a,b){if(0===arguments.length)return{x:k.x,y:k.y};if(2!==arguments.length)throw new Error("invalid arguments for offset");k={x:a,y:b}}},pxcan.prototype.panel=pxcan.Panel.prototype.panel=function(a,b,c,d,e,f){if(4===arguments.length)return new pxcan.Panel(this,a,b,c,d);if(6===arguments.length)return new pxcan.Panel(this,a,b,c,d,e,f);throw new Error("invalid number of arguments.")},pxcan.prototype.setBackground=function(a){(this.element!==window?this.element:document.getElementsByTagName("body")[0]).style.background=a},pxcan.prototype.toCanvasCoords=pxcan.Panel.prototype.toCanvasCoords=function(a,b,c,d,e,f){if(6!==arguments.length)throw new Error("toCanvasCoords requires 6 arguments");(void 0===e||null===e)&&(e=this.origin().x),(void 0===f||null===f)&&(f=this.origin().y);var g=Math.round(this.canvasOffX+a+this.offset().x+this.width*(this.origin().x+1)/2-(c||0)*(e+1)/2),h=Math.round(this.canvasOffY+b+this.offset().y+this.height*(this.origin().y+1)/2-(d||0)*(f+1)/2),i=Math.max(0,this.canvasOffX-g,-g),j=Math.max(0,this.canvasOffY-h,-h),k=Math.max(0,g+c-(this.canvasOffX+this.width),g+c-(this.screen||this).width),l=Math.max(0,h+d-(this.canvasOffY+this.height),h+d-(this.screen||this).height);return i+k>=c||j+l>=d?null:{x:g+i,y:h+j,width:c-i-k,height:d-j-l,lcut:i,tcut:j,rcut:k,bcut:l}},pxcan.prototype.clear=pxcan.Panel.prototype.clear=function(a,b,c,d,e,f){if(-1===[0,4,6].indexOf(arguments.length))throw new Error("bad arguments for clear");if(0===arguments.length)return void(this instanceof pxcan?this.context.clearRect(0,0,this.canvas.width,this.canvas.height):this.context.clearRect(this.canvasOffX*this.drawScale,this.canvasOffY*this.drawScale,this.width*this.drawScale,this.height*this.drawScale));var g=this.toCanvasCoords(a,b,c,d,e,f);g&&this.context.clearRect(g.x*this.drawScale,g.y*this.drawScale,g.width*this.drawScale,g.height*this.drawScale)},pxcan.prototype.reset=function(){this.clear(),this.origin(0,0),this.offset(0,0)},pxcan.prototype.fill=pxcan.Panel.prototype.fill=function(a,b,c,d,e,f,g){if(-1===[1,5,7].indexOf(arguments.length))throw new Error("bad arguments for fill");var h=this.context.fillStyle;if(this.context.fillStyle=a,1===arguments.length)return this instanceof pxcan?this.context.fillRect(0,0,this.canvas.width,this.canvas.height):this.context.fillRect(this.canvasOffX*this.drawScale,this.canvasOffY*this.drawScale,this.width*this.drawScale,this.height*this.drawScale),void(this.context.fillStyle=h);var i=this.toCanvasCoords(b,c,d,e,f,g);i&&(this.context.fillRect(i.x*this.drawScale,i.y*this.drawScale,i.width*this.drawScale,i.height*this.drawScale),this.context.fillStyle=h)},pxcan.prototype.blit=pxcan.Panel.prototype.blit=function(a){var b=arguments;if(-1===[3,4,5,6,7,8].indexOf(arguments.length))throw new Error("bad arguments for blit");var c,d,e=null,f=null,g="",h=void 0,i=void 0;!function(){var a=void 0;"number"==typeof b[b.length-3]&&"number"==typeof b[b.length-4]?(c=b[b.length-4],d=b[b.length-3],h=b[b.length-2],i=b[b.length-1],a=b.length-4):(c=b[b.length-2],d=b[b.length-1],a=b.length-2);var j=1;a>j&&Array.isArray(b[j])&&(e=b[j],++j),a>j&&-1!==["number","object"].indexOf(_typeof(b[j]))&&(f=b[j],++j),a>j&&"string"==typeof b[j]&&(g=b[j],++j)}();var j=this.sheet(a);if(!j)throw new Error("unknown sheet: "+a);var k=e&&e.length>0?pxcan.recolorImage(j.src,e):j.src,l=null!==f?j.getSprite(f):j,m=!1,n=!1,o=!1;g.replace("90","c").replace("180","xy").replace("270","cxy").split("").forEach(function(a){if("x"===a||"h"===a)m=!m;else if("y"===a||"v"===a)n=!n;else if("c"===a){o&&(m=!m,n=!n),o=!o;var b=m;m=n,n=b}});var p=this.toCanvasCoords(c,d,o?l.height:l.width,o?l.width:l.height,h,i);p&&((m||n||o)&&(this.context.save(),this.context.setTransform(+!o&&(m?-1:1),+o&&(n?-1:1),+o&&(m?1:-1),+!o&&(n?-1:1),this.canvas.width*+m,this.canvas.height*+n)),o?this.context.drawImage(pxcan.scaledImage(k,this.drawScale),(l.left+(n?p.bcut:p.tcut))*this.drawScale,(l.top+(m?p.lcut:p.rcut))*this.drawScale,p.height*this.drawScale,p.width*this.drawScale,this.canvas.height*+n+(p.y*(n?-1:1)-p.height*+n)*this.drawScale,-this.canvas.width*+m-(p.x*(m?-1:1)+p.width*+!m)*this.drawScale,p.height*this.drawScale,p.width*this.drawScale):this.context.drawImage(pxcan.scaledImage(k,this.drawScale),(l.left+(m?p.rcut:p.lcut))*this.drawScale,(l.top+(n?p.bcut:p.tcut))*this.drawScale,p.width*this.drawScale,p.height*this.drawScale,this.canvas.width*+m+(p.x*(m?-1:1)-p.width*+m)*this.drawScale,this.canvas.height*+n+(p.y*(n?-1:1)-p.height*+n)*this.drawScale,p.width*this.drawScale,p.height*this.drawScale),(o||m||n)&&this.context.restore())},pxcan.prototype.write=pxcan.Panel.prototype.write=function(a){if(-1===[3,4,5,6].indexOf(arguments.length))throw new Error("bad arguments for write");if(void 0===a||null===a)throw new Error("text is "+a);"string"!=typeof a&&(a=a.toString());var b,c,d,e,f,g,h="number"==typeof arguments[1]?1:2;b="number"==typeof arguments[1]?[]:[arguments[1]],c=arguments[h],d=arguments[h+1],arguments.length>=h+3?(e=arguments[h+2],f=arguments[h+3]):(e=this.origin().x,f=this.origin().y),g=-1!==[h+3,h+5].indexOf(arguments.length)?arguments[arguments.length-1]:0;var i=this.sheet(this.font);if("string"==typeof g)if("left"===g)g=0;else if("center"===g)g=.5;else{if("right"!==g)throw new Error("unknown text alignment: "+g);g=1}for(var j=a.split("\n"),k=0,l=0;l<j.length;++l)k=Math.max(j[l].length,k);for(var m=i.spriteWidth,n=i.spriteHeight,o=Math.round(c-(k-1)*m*((e+1)/2)),p=Math.round(d-(j.length-1)*n*((f+1)/2)),q=0;q<j.length;++q)for(var r=Math.round((k-j[q].length)*g*m),s=0;s<j[q].length;++s)this.blit(this.font,b,j[q].charCodeAt(s)-32,o+r+s*m,p+q*n,e,f)},pxcan.prototype.border=pxcan.Panel.prototype.border=function(){var a="pxborder",b=null;arguments.length>0&&("string"==typeof arguments[0]&&(a=arguments[0]),Array.isArray(arguments[arguments.length-1])&&(b=arguments[arguments.length-1]));var c=this.origin(),d=this.offset();this.origin(-1,-1),this.offset(0,0);for(var e=this.sheet(a).spriteWidth,f=e;f<this.width-e;f+=e)this.blit(a,b,{col:1,row:0},f,0,-1,-1),this.blit(a,b,{col:1,row:2},f,this.height,-1,1);for(var g=this.sheet(a).spriteHeight,h=g;h<this.height-g;h+=g)this.blit(a,b,{col:0,row:1},0,h,-1,-1),this.blit(a,b,{col:2,row:1},this.width,h,1,-1);this.blit(a,b,{col:0,row:0},0,0,-1,-1),this.blit(a,b,{col:2,row:0},this.width,0,1,-1),this.blit(a,b,{col:0,row:2},0,this.height,-1,1),this.blit(a,b,{col:2,row:2},this.width,this.height,1,1),this.origin(c.x,c.y),this.offset(d.x,d.y)},function(){var a=[],b={},c={},d=0,e={};pxcan.assignId=function(){var b=-1;return function(d){return a.push(d),c[b+1]=0,++b}}(),pxcan.isPreloading=function(a){return!!c[a.id]||d>0},pxcan.preload=function(f,g){function h(){if(e[f]={image:j,scaledImages:{1:document.createElement("canvas")}},e[f].scaledImages[1].width=j.width,e[f].scaledImages[1].height=j.height,e[f].scaledImages[1].getContext("2d").drawImage(j,0,0),i?--d:b[f].forEach(function(a){return--c[a.id]}),!(d>0||b[f]&&b[f].every(function(a){return c[a.id]}))){var g=i?a:b[f];g.filter(function(a){return!c[a.id]}).forEach(function(a){a.onReady&&a.onReady.call(a),a.onReady=null}),delete b[f]}}var i=!g;if(!f)throw new Error("missing source image");if(e[f])return void console.log("note: "+f+" was already preloaded.");if(b[f])return i?void console.log("note: "+f+" was already requested to be preloaded"):b[f].indexOf(g)>=0?void console.log("note: "+f+" was already requested to be preloaded by this pxcan"):(console.log("note: "+f+" was already requested to be preloaded by a different pxcan"),b[f].push(g),void++c[g.id]);i?++d:(b[f]=[g],++c[g.id]);var j=new Image;j.onload=h,j.onerror=function(){throw new Error("Failed to load image "+f)},j.src=f},pxcan.hasImage=function(a){return!!e[a]},pxcan.image=function(a){if(!pxcan.hasImage(a))throw new Error("invalid image src: "+a);return e[a].image},pxcan.recolorImage=function(a,b){if(!e[a])throw new Error("invalid image src: "+a);var c=a+"@"+b.join(",");if(e[c])return c;var d=document.createElement("canvas"),f=e[a].scaledImages[1];d.width=f.width,d.height=f.height;var g=d.getContext("2d"),h=new Uint32Array(f.getContext("2d").getImageData(0,0,f.width,f.height).data.buffer),i=[],j=Array.prototype.map.call(h,function(a){if(0===(4278190080&a))return 0;var b=i.indexOf(a);return-1!==b?b+1:(i.push(a),i.length)});i=i.map(function(a,b){return{oldIdx:b,brightness:(255&a)+((65280&a)>>8)+((16711680&a)>>16)}}).sort(function(a,b){return a.brightness-b.brightness}),i.forEach(function(a,b){return a.bIdx=b+1}),i.sort(function(a,b){return a.oldIdx-b.oldIdx}),j=Array.prototype.map.call(j,function(a){return 0===a?0:i[a-1].bIdx});for(var k=0,l=0;l<f.height;++l)for(var m=0;m<f.width;++m)0!==j[k]&&(g.fillStyle=b[j[k]-1],g.fillRect(m,l,1,1)),++k;return e[c]={scaledImages:{1:d}},c},pxcan.scaledImage=function(a,b){if(!e[a])throw new Error("invalid image src: "+a);if(e[a].scaledImages[b])return e[a].scaledImages[b];var c=document.createElement("canvas"),d=e[a].scaledImages[1];c.width=d.width*b,c.height=d.height*b;for(var f=c.getContext("2d"),g=d.getContext("2d").getImageData(0,0,d.width,d.height).data,h=0,i=0;i<d.height;++i)for(var j=0;j<d.width;++j)f.fillStyle="rgba("+g[h]+","+g[h+1]+","+g[h+2]+","+g[h+3]+")",f.fillRect(j*b,i*b,b,b),h+=4;return e[a].scaledImages[b]=c,c}}(),pxcan.Sheet=function(a,b,c,d){Object.defineProperty(this,"alias",{get:function(){return a}}),Object.defineProperty(this,"img",{get:function(){return pxcan.image(b)}}),Object.defineProperty(this,"src",{get:function(){return b}}),Object.defineProperty(this,"left",{get:function(){return 0}}),Object.defineProperty(this,"top",{get:function(){return 0}}),Object.defineProperty(this,"width",{get:function(){return this.img.width}}),Object.defineProperty(this,"height",{get:function(){return this.img.height}}),Object.defineProperty(this,"spriteWidth",{get:function(){return c||this.img.width}}),Object.defineProperty(this,"spriteHeight",{get:function(){return d||this.img.height}}),Object.defineProperty(this,"numCols",{get:function(){return Math.floor(this.img.width/c)}}),Object.defineProperty(this,"numRows",{get:function(){return Math.floor(this.img.height/d)}}),Object.defineProperty(this,"numSprites",{get:function(){return this.numCols*this.numRows}})},pxcan.Sheet.prototype.scaledImage=function(a){return pxcan.scaledImage(this.src,a)},pxcan.Sheet.prototype.getSprite=function(a){return new pxcan.Sprite(this,a)},pxcan.Sprite=function(a,b){if(void 0===b||null===b)throw new Error("bad frame while constructing sprite");"number"==typeof b&&b%1===0&&(b={col:b%a.numCols,row:Math.floor(b/a.numCols)});var c=void 0!==b.x?b.x:b.col?b.col*a.spriteWidth:0,d=void 0!==b.y?b.y:b.row?b.row*a.spriteHeight:0,e=void 0!==b.width?b.width:void 0!==b.col?a.spriteWidth:a.width-c,f=void 0!==b.height?b.height:void 0!==b.row?a.spriteHeight:a.height-d;Object.defineProperty(this,"sheet",{get:function(){return a}}),Object.defineProperty(this,"img",{get:function(){return a.img}}),Object.defineProperty(this,"left",{get:function(){return c}}),Object.defineProperty(this,"top",{get:function(){return d}}),Object.defineProperty(this,"width",{get:function(){return e}}),Object.defineProperty(this,"height",{get:function(){return f}})},pxcan.Sprite.prototype.scaledImage=function(a){return pxcan.scaledImage(this.sheet.src,a)},pxcan.globalSheets={},function(){function a(a,b,c,d){pxcan.preload(a),pxcan.globalSheets[b]=new pxcan.Sheet(b,a,c,d)}a("data:image/png;base64,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","px8",8,8),a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAABICAYAAACECrc3AAACZElEQVRogeWWSXKDQAxFff9Lk03KBeJP6gbcTrSJERqevkRVXq9vte3X9s/7v8q/7Qy9Y3Go7xTgRgwNwoZjA0eAaZyC7sBdbg7GAU7BJglu7QxGDfe9Vg+creSJaU89GFDyhd0BPASY3htrmN4ajEkVTAuOqirz3A1e0sTEfu/X3PlIOh9T3Qi6a3bTbz/7EFAyA+j4UD307gDIirPCSkWkglLPwiuVFIjKTXydOtEtpMowmGRgCri8pdN9hAXtf/bOUCP3LHspBUdUTPNY3MHfUehuBVuTJAXuuNFP3P28oXtjz+5WVS0WJ/u41e4LIh/KV7koTvnsf8qJMgkgEwLFU2qnVtpY5SoYCovUYjBOCaU066HqrW9OLedjubXH8JZQIHtWhStMAljzIQtK7gDWPFcHQVlABpQqyBreBuhWkgC6xmpQ1GtdY8TV5+KuULC14q4PDa5+twDTiROlU0AEBhmYCrUx+818twPSBFAwBWZxSb11TUlefckdOpVYbwmIbkEVSe8tyWlDVl9t3gV24BGcgkwajEK3AF3R9AZVbsLCeqxrKenIRB3V6vMhl93QPtCt1zVxZ1Cf5XAo0Plc7szAjwC6Pp13cJInVszi1jYlP1NrJPdywE5ucovDJ+MClU8plQCqQQ+AqqhrXH0qzsEMAdaVJBAzgGor/8cuVcB9JHUlNZadAsqtdRJf+z7qEGxo9jwE2FGQGSxu3qntQAVVYxTHhqvNVCyCYjX/tqUrTmu9VewcsFqTA1I+x0AD1X3VOChFyUnEON0kJDZTKmAWm6751I/dDpq4o+oIHOr1AxFeE6QKBXbuAAAAAElFTkSuQmCC","px6",5,6),a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAhElEQVRIie2WwQrAIAxDU/H/fzk7CdHVwdYWdjCXipQX04NqJIlCdVkbAG5q2EAh3NSQgUJCJxaeAaAm+DqONaEpp22a3mgCrrwmTVG5jIwEj8pM4HKa15WpY3AM/m3AagOrNrglyLouJp4aZF1400u4vmhZJmMa7IiPxvsojH1Y9bflAvhRIjH91XRBAAAAAElFTkSuQmCC","pxborder",8,8)}();var pxMath={mid:function(){for(var a=[],b=0;b<arguments.length;++b)a.push(+arguments[b]);return a.sort(function(a,b){return a-b}),a.length%2===1?a[Math.floor(a.length/2)]:(a[Math.floor(a.length/2)]+a[Math.floor(a.length/2)-1])/2},clamp:function(a,b,c){return 2===arguments.length&&(c=arguments[1],b=-arguments[1]),pxMath.mid(b,a,c)}};pxcan.random=function(){function a(a){var b,c,d,e=0;if(0==a.length)return e;for(b=0,d=a.length;d>b;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return e}function b(b){if("number"==typeof b)return b;if("string"==typeof b)return a(b);throw new Error("not sure what to do with seed: "+b)}function c(a){var d=b(a),e=function(){var a=1e4*Math.sin(d++);if(a-=Math.floor(a),0===arguments.length)return a;if(1===arguments.length&&arguments[0]instanceof Array)return arguments[0][Math.floor(a*arguments[0].length)];if(1===arguments.length)return Math.floor(a*arguments[0]);if(2===arguments.length)return Math.floor(a*(arguments[1]+1-arguments[0]))+arguments[0];throw new Error("invalid arguments for random generator.")};return e.seed=function(a){d=b(a)},e.create=function(a){return c(void 0!==a?a:e())},e}return c(Math.random())}(),pxcan.wrapString=function(a,b,c){if(!a)return a;var d=".{1,"+b+"}(\\s|$)|.{"+b+"}|.+$",e=a.match(RegExp(d,"g"));c&&(e=e.slice(0,c));for(var f=0;f<e.length;++f)e[f]=e[f].trim();return e.join("\n")};