{"version":3,"sources":["pxcan.js"],"names":[],"mappings":"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","file":"pxcan.babel.js","sourcesContent":["var pxcan = function(element) {\n  // vars\n  var self = this;\n  element = element || window;\n  if(typeof(element) === 'string') element = document.querySelector(element);\n  var mode = { name: 'adapt' };\n  var width = element.clientWidth || element.innerWidth;\n  var height = element.clientHeight || element.innerWidth;\n  var scale = 1;\n  var needsRepaint = true;\n  var prevDims = null;\n  var font = \"pxcan-ascii\";\n  var sheets = {};\n  var _origin = { x: 0, y: 0 };\n  var _offset = { x: 0, y: 0 };\n  var binds = {};\n  var buttons = {};\n  var touch = {\n    changed: false,\n    isDown: false,\n    isMouse: undefined,\n    isRightClick: undefined,\n    wasStarted: false,\n    moved: false,\n    isDrag: false,\n    wasReleased: false,\n    wasInterrupted: false,\n    cur: undefined,\n    last: undefined,\n    start: undefined,\n    x: null,\n    y: null,\n    inBounds: null,\n    rel: null,\n    bounded: null,\n    unbounded: null\n  };\n  var frameskipCounter = 0;\n  var clock = 0;\n  \n  // create canvas element\n  var canvas = document.createElement('canvas');\n  canvas.style.display = 'block';\n  canvas.style.margin = 'auto';\n  // drawing context\n  var context = canvas.getContext('2d');\n  // if we're adding it to the WINDOW then make sure it is fullscreeny\n  if(element == window) {\n    var body = document.querySelector('body');\n    body.style.padding = 0;\n    body.style.margin = 0;\n    body.style.overflow = 'hidden';\n  }\n  // put canvas on page\n  ((element !== window)? element: document.getElementsByTagName('body')[0]).appendChild(canvas);\n  // make it selectable (if it's not just in the window)\n  if(element !== window && element.tabIndex < 0) element.tabIndex = 0;\n  \n  // public properties\n  function DEF(name, attr) {\n    Object.defineProperty(self, name, attr);\n  }\n  var _id = pxcan.assignId(this);\n  DEF('id', { get: function() { return _id; } })\n  DEF('element', { get: function() { return element; } });\n  DEF('canvas', { get: function() { return canvas; } });\n  DEF('context', { get: function() { return context; } });\n  DEF('canvasOffX', { get: function() { return 0; } });\n  DEF('canvasOffY', { get: function() { return 0; } });\n  DEF('left', { get: function() {\n    return Math.round(-_offset.x - (width * (_origin.x + 1) / 2));\n  } });\n  DEF('top', { get: function() {\n    return Math.round(-_offset.y - (height * (_origin.y + 1) / 2));\n  } });\n  DEF('right', { get: function() { return this.left + width - 1; } });\n  DEF('bottom', { get: function() { return this.top + height - 1; } });\n  DEF('width', { get: function() { return width; } });\n  DEF('height', { get: function() { return height; } });\n  DEF('drawScale', { get: function() { return scale; } });\n  DEF('wasResized', { get: function() { return needsRepaint; } });\n  DEF('clock', { get: function() { return clock; } });\n  DEF('frameskip', { value: 0, writable: true });\n  this.origin = function(x, y) {\n    if(arguments.length === 0) return { x: _origin.x, y: _origin.y };\n    if(arguments.length === 2) _origin = { x: x, y: y };\n    else throw new Error('invalid arguments for origin');\n  };\n  this.offset = function(x, y) {\n    if(arguments.length === 0) return { x: _offset.x, y: _offset.y };\n    if(arguments.length === 2) _offset = { x: x, y: y };\n    else throw new Error('invalid arguments for offset');\n  };\n  DEF('font', {\n    set: function(x) {\n      if(!this.hasSheet(x)) throw new Error('invalid font: ' + x);\n      font = x;\n    },\n    get: function() {\n      if(!font) throw new Error('font has not been set.');\n      return font;\n    }\n  });\n  \n  // screen mode/sizing components\n  this.mode = function(newMode) {\n    // if no arguments are given, treat as getter function\n    if(arguments.length === 0) return mode.name;\n    // otherwise set appropriately\n    if(newMode === 'adapt') {\n      mode = { name: 'adapt' };\n      scale = arguments[1] || 1;\n      canvas.style.width = '';\n      canvas.style.height = '';\n    }\n    else if(newMode === 'fixed') {\n      mode = { name: 'fixed' };\n      if(arguments.length <= 2) {\n        scale = arguments[1] || 1;\n        width = Math.floor((element.clientWidth || element.innerWidth) / scale);\n        height = Math.floor((element.clientHeight || element.innerHeight) / scale);\n      }\n      else {\n        width = arguments[1];\n        height = arguments[2];\n        scale = arguments[3] || 1;\n      }\n      canvas.style.width = '';\n      canvas.style.height = '';\n    }\n    else if(newMode === 'scale-overflow') {\n      mode = {\n        name: 'scale-overflow',\n        minWidth: arguments[1] || element.clientWidth || element.innerWidth,\n        minHeight: arguments[2] || element.clientHeight || element.innerHeight\n      };\n      canvas.style.width = '100%';\n      canvas.style.height = '100%';\n    }\n    else if(newMode === 'scale') {\n      throw new Error('not yet supported.');\n    }\n    else {\n      throw new Error('unknown mode type.');\n    }\n    // reset these\n    needsRepaint = true;\n    prevDims = null;\n    this.fitElement();\n  };\n  \n  this.setSize = function(w, h) {\n    if(mode.name === 'fixed' || mode.name === 'scale') {\n      width = w;\n      height = h;\n    }\n    else if(mode.name === 'scale-overflow') {\n      mode.minWidth = w;\n      mode.minHeight = h;\n    }\n    else {\n      throw new Error('screen mode does not support setSize: ' + mode.name);\n    }\n    this.fitElement();\n  };\n  \n  this.setScale = function(s) {\n    if(mode.name === 'adapt' || mode.name === 'fixed') {\n      scale = s;\n    }\n    else {\n      throw new Error('screen mode does not support setScale: ' + mode.name);\n    }\n    this.fitElement();\n  };\n  \n  // screen fitting\n  this.fitElement = function() {\n    // get the current width/height of the elemnt\n    var w = element.clientWidth || element.innerWidth;\n    var h = element.clientHeight || element.innerHeight;\n    // has it actually changed? if not, no need to fit it.\n    needsRepaint = !prevDims || (prevDims.w !== w) || (prevDims.h !== h);\n    if(!needsRepaint) return;\n    // otherwise, do the correct resize function for the mode\n    if(mode.name === 'adapt') fitAdapt(w, h);\n    else if(mode.name === 'fixed') fitFixed(w, h);\n    else if(mode.name === 'scale-overflow') fitScaleOverflow(w, h);\n    // if the view is the whole window, then keep it at the right location\n    if(element === window) {\n      window.scrollTo(0, 0);\n    }\n    // record previous dimensions\n    prevDims = { w: w, h: h };\n  };\n  \n  function fitAdapt(w, h) {\n    // resize canvas to fill window\n    canvas.width = (width = Math.floor(w/scale)) * scale;\n    canvas.height = (height = Math.floor(h/scale)) * scale;\n  }\n  \n  function fitFixed(w, h) {\n    // just resize to the expected dimensions if it's not already that\n    if(canvas.width !== width * scale) canvas.width = width * scale;\n    if(canvas.height !== height * scale) canvas.height = height * scale;\n  }\n  \n  function fitScaleOverflow(w, h) {\n    // if the desired aspect ratio is equal\n    if(mode.minWidth * h === mode.minHeight * w) {\n      width = mode.minWidth;\n      height = mode.minHeight;\n    }\n    // if it needs to be WIDER\n    else if(mode.minWidth * h < mode.minHeight * w) {\n      width = Math.floor(w / h * mode.minHeight);\n      height = mode.minHeight;\n    }\n    // if it needs to be TALLER\n    else {\n      width = mode.minWidth;\n      height = Math.floor(h / w * mode.minWidth);\n    }\n    // draw at a lower scale...\n    scale = Math.floor(Math.min(h/height, w/width));\n    if(scale < 1) scale = 1; //unless it's smaller than minimum\n    canvas.width = width * scale;\n    canvas.height = height * scale;\n  }\n  \n  this.fitElement();\n  \n  // sheet loading\n  this.preload = function(src, alias, w, h) {\n    if(!alias && alias !== 0) throw new Error(\"missing alias\");\n    if(sheets[alias]) throw new Error(\"sheet already exists with alias \" + alias);\n    if(pxcan.globalSheets[alias]) throw new Error(\"global sheet already exists with alias \" + alias);\n    if(!pxcan.hasImage(src)) {\n      pxcan.preload(src, this);\n    }\n    sheets[alias] = new pxcan.Sheet(alias, src, w, h);\n  };\n  \n  this.sheet = function(alias) {\n    if(sheets[alias]) return sheets[alias];\n    if(pxcan.globalSheets[alias]) return pxcan.globalSheets[alias];\n    throw new Error(\"invalid sheet: \" + alias);\n  };\n  \n  this.hasSheet = function(alias) {\n    return !!(sheets[alias] || pxcan.globalSheets[alias]);\n  };\n  \n  // onReady and onFrame events\n  DEF('isPreloading', { get: function() { return pxcan.isPreloading(this); } });\n  var _onready = null;\n  DEF('onReady', {\n    get: function() { return _onready; },\n    set: function(x) {\n      if(x && !this.isPreloading) x.call(this);\n      else _onready = x;\n    }\n  });\n  DEF('onFrame', { writable: true });\n  \n  var raf = window.requestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    window.oRequestAnimationFrame;\n  function rafFunc() {\n    ++frameskipCounter;\n    if(frameskipCounter > self.frameskip) {\n      frameskipCounter = 0;\n      // re-fit screen\n      self.fitElement();\n      // call frame function\n      if(self.onFrame && !self.isPreloading) self.onFrame.call(self, self);\n      // update input state\n      updateButtons();\n      updateTouch();\n      // update clock\n      ++clock;\n    }\n    // queue next call\n    raf(rafFunc);\n  }\n  raf(rafFunc);\n  \n  // built-in button functions \n  this.bind = function(button /*, key1, [key2, [...]] */) {\n    for(var i = 1; i < arguments.length; ++i) {\n      var code = arguments[i];\n      if(typeof(code) === 'string') code = code.toUpperCase().charCodeAt(0);\n      binds[code] = button;\n    }\n    buttons[button] = {\n      wasPressed: false,\n      wasReleased: false,\n      isDown: false,\n      framesDown: 0\n    };\n  };\n  \n  this.button = function(b) { return buttons[b]; };\n  \n  function keyevt(evt) {\n    if(binds[evt.keyCode] === undefined) return true;\n    \n    evt.preventDefault();\n    var button = buttons[binds[evt.keyCode]];\n    if(evt.type === 'keydown' && button.framesDown === 0) {\n      button.wasPressed = button.isDown = true;\n      button.framesDown = 0;\n    }\n    else if(evt.type === 'keyup' && button.isDown) {\n      button.wasReleased = true;\n      button.isDown = false;\n    }\n  }\n  element.addEventListener(\"keydown\", keyevt, false);\n  element.addEventListener(\"keyup\", keyevt, false);\n\n  function updateButtons() {\n    for (var b in buttons) {\n      if(buttons[b].wasPressed) buttons[b].wasPressed = false;\n      if(buttons[b].wasReleased) buttons[b].wasReleased = false;\n      if(buttons[b].isDown) ++buttons[b].framesDown;\n      else buttons[b].framesDown = 0;\n    }\n  }\n\n  // touch stuff (mouse and touch)\n  DEF('touch', { get: function() { return touch; } });\n  DEF('contextMenu', { value: true, writable: true });\n  \n  function evtToCoords(evt) {\n    // raw coordinates relative to screen top left\n    var xOnScreen = evt.clientX - (element.clientLeft || 0) - (element.offsetLeft || 0) + window.scrollX;\n    var yOnScreen = evt.clientY - (element.clientTop || 0) - (element.offsetTop || 0) + window.scrollY;\n\n    // pixel based coordinates relative to screen top left\n    return {\n      fromLeft: Math.floor(xOnScreen / (element.clientWidth || element.innerWidth) * self.width),\n      fromTop: Math.floor(yOnScreen / (element.clientHeight || element.innerHeight) * self.height)\n    };\n  }\n  function TouchPoint(fromLeft, fromTop, ref, bounded) {\n    ref = ref || self;\n    bounded = bounded || false;\n\n    Object.defineProperty(this, 'x', { get: function() {\n      return (bounded? pxMath.clamp(fromLeft, 0, ref.width-1): fromLeft) + ref.left - ref.canvasOffX;\n    } });\n    Object.defineProperty(this, 'y', { get: function() {\n      return (bounded? pxMath.clamp(fromTop, 0, ref.height-1): fromTop) + ref.top - ref.canvasOffY;\n    } });\n    Object.defineProperty(this, 'inBounds', { get: function() {\n      return bounded || (this.x === this.bounded().x && this.y === this.bounded().y); \n    } });\n    this.rel = function(ref, bounded) {\n      if(['bounded','b','unbounded','u',undefined].indexOf(bounded) === -1) {\n        throw new Error('bad value for \"bounded\" parameter.');\n      }\n      return new TouchPoint(fromLeft, fromTop, ref, bounded && bounded.startsWith('b'));\n    };\n    (function(self) {\n      self.bounded = function() { return self.rel(ref, 'bounded'); };\n      self.unbounded = function() { return self.rel(ref, 'unbounded'); };\n    })(this);\n  }\n  \n  ['x','y','inBounds','rel','bounded','unbounded'].forEach(function(attr) {\n    Object.defineProperty(touch, attr, { get: function() {\n      if(touch.cur === undefined) throw new Error('No touch events happening.');\n      return touch.cur[attr];\n    } });\n  });\n\n  function onTouchStart(fromLeft, fromTop) {\n    touch.cur = touch.start = new TouchPoint(fromLeft, fromTop);\n    touch.changed = true;\n    touch.isDown = true;\n    touch.wasStarted = true;\n  }\n  function onTouchMove(fromLeft, fromTop) {\n    touch.cur = new TouchPoint(fromLeft, fromTop);\n    \n    if(touch.last && (touch.x === touch.last.x) && (touch.y === touch.last.y)) return;\n    touch.changed = true;\n    touch.moved = true;\n    touch.isDrag = true;\n  }\n  function onTouchEnd() {\n    touch.changed = true;\n    touch.isDown = false;\n    touch.wasReleased = true;\n  }\n\n  function updateTouch() {\n    touch.changed = false;\n    touch.wasStarted = false;\n    touch.moved = false;\n    touch.wasReleased = false;\n    touch.wasInterrupted = false;\n    if(touch.isDown) {\n      touch.last = touch.cur;\n    }\n    else {\n      touch.cur = touch.last = touch.start = undefined;\n      touch.isMouse = undefined;\n      touch.isRightClick = undefined;\n      touch.isDrag = false;\n    }\n  }\n  \n  // mouse!\n  element.addEventListener(\"mousedown\", function(mouseEvt) {\n    if(touch.isDown) return;\n    var coords = evtToCoords(mouseEvt);\n    onTouchStart(coords.fromLeft, coords.fromTop);\n    touch.isMouse = true;\n    touch.isRightClick = (mouseEvt.button === 2);\n  }, false);\n\n  window.addEventListener(\"mousemove\", function(mouseEvt) {\n    if(!touch.isMouse) return;\n    var coords = evtToCoords(mouseEvt);\n    onTouchMove(coords.fromLeft, coords.fromTop);\n  }, false);\n  \n  window.addEventListener(\"mouseup\", function(mouseEvt) {\n    if(!touch.isMouse) return;\n    onTouchEnd();\n  }, false);\n\n  // touch.\n  var currentTouchId = undefined;\n  element.addEventListener(\"touchstart\", function(touchEvt) {\n    touchEvt.preventDefault();\n    if(touch.isDown) return;\n    \n    var coords = evtToCoords(touchEvt.changedTouches[0]);\n    onTouchStart(coords.fromLeft, coords.fromTop);\n    touch.isMouse = false;\n    currentTouchId = touchEvt.changedTouches[0].identifier;\n  }, false);\n\n  element.addEventListener(\"touchmove\", function(touchEvt) {\n    touchEvt.preventDefault();\n    if(!touch.isDown || touch.isMouse) return;\n\n    var currentTouch = Array.prototype.find.call(touchEvt.changedTouches, function(e) {\n      return e.identifier === currentTouchId;\n    });\n    if(!currentTouch) return;\n\n    var coords = evtToCoords(currentTouch);\n    onTouchMove(coords.fromLeft, coords.fromTop);\n  }, false);\n\n  element.addEventListener(\"touchend\", function(touchEvt) {\n    touchEvt.preventDefault();\n    if(!touch.isDown || touch.isMouse) return;\n\n    var currentTouch = Array.prototype.find.call(touchEvt.changedTouches, function(e) {\n      return e.identifier === currentTouchId;\n    });\n    if(!currentTouch) return;\n    \n    if(touchEvt.targetTouches.length === 0) { // no more touches; release\n      onTouchEnd();\n      currentTouchId = null;\n    }\n    else { // other touches on screen; 'drag' to the lastest one\n      var nextTouch = touchEvt.targetTouches[touchEvt.targetTouches.length-1];\n      currentTouchId = nextTouch.identifier;\n      onTouchMove(nextTouch);\n    }\n  }, false);\n  \n  // optional right click menu event capture\n  element.addEventListener(\"contextmenu\", function(e) {\n    if(!self.contextMenu) e.preventDefault();\n  });\n\n  // does this element have focus?\n  DEF('hasFocus', { get: function() {\n    return document.hasFocus() && document.activeElement === element;\n  } });\n};\n\npxcan.Panel = function(parent, x, y, w, h, xAnchor, yAnchor) {\r\n  // verify arguments\r\n  if([5,7].indexOf(arguments.length)===-1)\r\n    throw new Error('invalid number of arguments.');\r\n  // vars\r\n  if(arguments.length === 5) {\r\n    xAnchor = parent.origin().x;\r\n    yAnchor = parent.origin().y;\r\n  }\r\n  var self = this;\r\n  var font = null;\r\n  var _origin = parent.origin();\r\n  var _offset = parent.offset();\r\n  var screen = parent.screen || parent;\r\n  \r\n  // subcanvas size\r\n  this.canvasOffX = Math.round(parent.canvasOffX + x + parent.width*(parent.origin().x+1)/2 - w*(xAnchor+1)/2);\r\n  this.canvasOffY = Math.round(parent.canvasOffY + y + parent.height*(parent.origin().y+1)/2 - h*(yAnchor+1)/2);\r\n  var width = Math.round(w);\r\n  var height = Math.round(h);\r\n\r\n  // inherited properties\r\n  ['element', 'canvas', 'context', 'drawScale', 'sheet'].forEach(function(attr) {\r\n    Object.defineProperty(self, attr, { get: function() { return screen[attr]; } });\r\n  });\r\n  \r\n  // public properties\r\n  Object.defineProperty(this, 'screen', { get: function() { return screen; } });\r\n  Object.defineProperty(this, 'left', { get: function() {\r\n    return Math.round(_offset.x - (width * (_origin.x + 1) / 2));\r\n  } });\r\n  Object.defineProperty(this, 'top', { get: function() {\r\n    return Math.round(_offset.y - (height * (_origin.y + 1) / 2));\r\n  } });\r\n  Object.defineProperty(this, 'right', { get: function() { return this.left + width - 1; } });\r\n  Object.defineProperty(this, 'bottom', { get: function() { return this.top + height - 1; } });\r\n  Object.defineProperty(this, 'width', { get: function() { return width; } });\r\n  Object.defineProperty(this, 'height', { get: function() { return height; } });\r\n  Object.defineProperty(this, 'font', {\r\n    set: function(x) {\r\n      if(!this.hasSheet(x)) throw new Error('invalid font: ' + x);\r\n      font = x;\r\n    },\r\n    get: function() { return font || parent.font; }\r\n  });\r\n  // methods\r\n  this.origin = function(x, y) {\r\n    if(arguments.length === 0) return { x: _origin.x, y: _origin.y };\r\n    if(arguments.length === 2) _origin = { x: x, y: y };\r\n    else throw new Error('invalid arguments for origin');\r\n  };\r\n  this.offset = function(x, y) {\r\n    if(arguments.length === 0) return { x: _offset.x, y: _offset.y };\r\n    if(arguments.length === 2) _offset = { x: x, y: y };\r\n    else throw new Error('invalid arguments for offset');\r\n  };\r\n  \r\n};\r\n\r\npxcan.prototype.panel =\r\npxcan.Panel.prototype.panel = function(x, y, w, h, xAnchor, yAnchor) {\r\n  if(arguments.length === 4)\r\n    return new pxcan.Panel(this, x, y, w, h);\r\n  else if(arguments.length === 6)\r\n    return new pxcan.Panel(this, x, y, w, h, xAnchor, yAnchor);\r\n  else\r\n    throw new Error('invalid number of arguments.');\r\n};\n\npxcan.prototype.setBackground = function(bg) {\n  ((this.element !== window)? this.element: document.getElementsByTagName('body')[0]).style.background = bg;\n};\n\npxcan.prototype.toCanvasCoords =\npxcan.Panel.prototype.toCanvasCoords = function(x, y, w, h, xAnc, yAnc) {\n  // make sure we got the right number of args\n  if(arguments.length !== 6)\n    throw new Error('toCanvasCoords requires 6 arguments');\n  // define xAnc and yAnc if not defined\n  if(xAnc === undefined || xAnc === null) xAnc = this.origin().x;\n  if(yAnc === undefined || yAnc === null) yAnc = this.origin().y;\n  // translate x and y into LEFT and TOP\n  var l = Math.round(this.canvasOffX + x + this.offset().x + this.width * (this.origin().x+1)/2 - (w || 0) * (xAnc+1)/2);\n  var t = Math.round(this.canvasOffY + y + this.offset().y + this.height * (this.origin().y+1)/2 - (h || 0) * (yAnc+1)/2);\n  // how much may need to be cut off the sides for sprites\n  var lcut = Math.max(0, this.canvasOffX-l, -l);\n  var tcut = Math.max(0, this.canvasOffY-t, -t);\n  var rcut = Math.max(0, (l+w)-(this.canvasOffX+this.width), (l+w)-((this.screen||this).width));\n  var bcut = Math.max(0, (t+h)-(this.canvasOffY+this.height), (t+h)-((this.screen||this).height));\n  // return null if the object didn't make it on the screen\n  if(lcut+rcut >= w || tcut+bcut >= h) return null;\n  // otherwise return a nice object\n  return {\n    x: l+lcut, y: t+tcut, width: w-lcut-rcut, height: h-tcut-bcut,\n    lcut: lcut, tcut: tcut, rcut: rcut, bcut: bcut\n  };\n};\n\npxcan.prototype.clear = \npxcan.Panel.prototype.clear = function(x, y, w, h, xAnc, yAnc) {\n  // verify valid arguments\n  if([0, 4, 6].indexOf(arguments.length) === -1)\n    throw new Error('bad arguments for clear');\n  // if no arguments are provided, clear the whole area\n  if(arguments.length === 0) {\n    if(this instanceof pxcan) {\n      this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n    else {\n      this.context.clearRect(\n        this.canvasOffX * this.drawScale,\n        this.canvasOffY * this.drawScale,\n        this.width * this.drawScale,\n        this.height * this.drawScale\n      );\n    }\n    return;\n  }\n  // translate to coordinates on canvas element\n  var coords = this.toCanvasCoords(x, y, w, h, xAnc, yAnc);\n  if(!coords) return;\n  // clear canvas\n  this.context.clearRect(coords.x * this.drawScale, coords.y * this.drawScale, coords.width * this.drawScale, coords.height * this.drawScale);\n};\n\npxcan.prototype.reset = function() {\n  this.clear();\n  this.origin(0, 0);\n  this.offset(0, 0);\n};\n\npxcan.prototype.fill =\npxcan.Panel.prototype.fill = function(color, x, y, w, h, xAnc, yAnc) {\n  // verify valid arguments\n  if([1, 5, 7].indexOf(arguments.length) === -1)\n    throw new Error('bad arguments for fill');\n  // set color\n  var temp = this.context.fillStyle;\n  this.context.fillStyle = color;\n  // if only the color is provided, fill the whole area\n  if(arguments.length === 1) {\n    if(this instanceof pxcan) {\n      this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n    else {\n      this.context.fillRect(\n        this.canvasOffX * this.drawScale,\n        this.canvasOffY * this.drawScale,\n        this.width * this.drawScale,\n        this.height * this.drawScale\n      );\n    }\n    this.context.fillStyle = temp;\n    return;\n  }\n  // translate to coordinates on canvas element\n  var coords = this.toCanvasCoords(x, y, w, h, xAnc, yAnc);\n  if(!coords) return;\n  // do fill on canvas\n  this.context.fillRect(coords.x * this.drawScale, coords.y * this.drawScale, coords.width * this.drawScale, coords.height * this.drawScale);\n  // set color back\n  this.context.fillStyle = temp;\n};\n\npxcan.prototype.blit =\npxcan.Panel.prototype.blit = function(sheetName, frame /* [flip], x, y, [xAnc, yAnc] */) {\n  // verify valid arguments\n  if([4,5,6,7].indexOf(arguments.length) === -1)\n    throw new Error('bad arguments for blit');\n  // get variable arguments\n  var flipArgs = (arguments.length%2 === 1)? arguments[2].toString(): '';\n  var x = arguments[arguments.length%2===0? 2: 3];\n  var y = arguments[arguments.length%2===0? 3: 4];\n  var xAnc = arguments.length>=6? arguments[arguments.length-2]: null;\n  var yAnc = arguments.length>=6? arguments[arguments.length-1]: null;\n  // get the sheet\n  var sheet = this.sheet(sheetName);\n  if(!sheet) throw new Error('unknown sheet: ' + sheetName);\n  // if a particular sprite is specified, get it\n  var sprite = (frame !== undefined && frame !== null)?\n    sheet.getSprite(frame): sheet;\n  // determine flip+rot\n  var xflip = false, yflip = false, cwrot = false;\n  flipArgs = flipArgs.replace('90', 'c');\n  flipArgs = flipArgs.replace('270', 'cxy');\n  flipArgs = flipArgs.replace('180', 'xy');\n  while(flipArgs.length > 0) {\n    if(flipArgs.startsWith('x') || flipArgs.startsWith('h')) {\n      xflip = !xflip;\n    }\n    else if(flipArgs.startsWith('y') || flipArgs.startsWith('v')) {\n      yflip = !yflip;\n    }\n    else if(flipArgs.startsWith('c')) {\n      if(cwrot) {\n        xflip = !xflip;\n        yflip = !yflip;\n      }\n      var temp = xflip;\n      xflip = yflip;\n      yflip = temp;\n      cwrot = !cwrot;\n    }\n    flipArgs = flipArgs.substr(1);\n  }\n  // coooordinates\n  var coords = this.toCanvasCoords(x, y, cwrot?sprite.height:sprite.width, cwrot?sprite.width:sprite.height, xAnc, yAnc);\n  if(!coords) return;\n  // flip+rotate\n  if(xflip || yflip) {\n    this.context.translate(this.canvas.width*+xflip, this.canvas.height*+yflip);\n    this.context.scale(xflip?-1:1, yflip?-1:1);\n  }\n  if(cwrot) {\n    this.context.rotate(Math.PI/2);\n  }\n  // draw it to the screen\n  if(!cwrot) this.context.drawImage(\n    // image\n    sprite.scaledImage(this.drawScale),\n    // location on the spritesheet\n    (sprite.left + (xflip?coords.rcut:coords.lcut)) * this.drawScale,\n    (sprite.top + (yflip?coords.bcut:coords.tcut)) * this.drawScale,\n    coords.width * this.drawScale, coords.height * this.drawScale,\n    // location on screen\n    this.canvas.width*+xflip + (coords.x*(xflip?-1:1) - coords.width*+xflip) * this.drawScale,\n    this.canvas.height*+yflip + (coords.y*(yflip?-1:1) - coords.height*+yflip) * this.drawScale,\n    coords.width * this.drawScale, coords.height * this.drawScale\n  );\n  else this.context.drawImage(\n    // image\n    sprite.scaledImage(this.drawScale),\n    // location on the spritesheet\n    (sprite.left + (yflip?coords.bcut:coords.tcut)) * this.drawScale,\n    (sprite.top + (xflip?coords.lcut:coords.rcut)) * this.drawScale,\n    coords.height * this.drawScale, coords.width * this.drawScale,\n    // location on screen\n    this.canvas.height*+yflip + (coords.y*(yflip?-1:1) - coords.height*+yflip) * this.drawScale,\n    -this.canvas.width*+xflip - (coords.x*(xflip?-1:1) + coords.width*+!xflip) * this.drawScale,\n    coords.height * this.drawScale, coords.width * this.drawScale\n  );\n  // undo flipping\n  if(cwrot) {\n    this.context.rotate(-Math.PI/2);\n  }\n  if(xflip || yflip) {\n    this.context.translate(this.canvas.width*+xflip, this.canvas.height*+yflip);\n    this.context.scale(xflip?-1:1, yflip?-1:1);\n  }\n};\n\npxcan.prototype.write =\npxcan.Panel.prototype.write = function(text, x, y /* [xAnc, yAnc], [align] */) {\n  // verify valid arguments\n  if(text === undefined || text === null) throw new Error('text is ' + text);\n  if(typeof(text) !== 'string') text = text.toString();\n  if([3,4,5,6].indexOf(arguments.length) === -1)\n    throw new Error('bad arguments for write');\n  // font\n  var font = this.sheet(this.font);\n  // anchor\n  var anchorX, anchorY;\n  if(arguments.length >= 5) {\n    anchorX = arguments[3];\n    anchorY = arguments[4];\n  }\n  else {\n    anchorX = this.origin().x;\n    anchorY = this.origin().y;\n  }\n  // text alignment\n  var align = 0;\n  if([4,6].indexOf(arguments.length) !== -1) {\n    align = arguments[arguments.length-1];\n    if(align === \"left\") align = 0;\n    else if(align === \"center\") align = 0.5;\n    else if(align === \"right\") align = 1;\n    else if(!(align >= 0 && align <= 1))\n      throw  new Error(\"unknown text alignment: \" + align);\n  }\n  // format text into lines & get max column width\n  var lines = text.split('\\n');\n  var maxcol = 0;\n  for(var i = 0; i < lines.length; ++i) maxcol = Math.max(lines[i].length, maxcol);\n  // where the top left char at\n  var ltrWidth = font.spriteWidth;\n  var ltrHeight = font.spriteHeight;\n  var leftx = Math.round(x - (maxcol - 1) * ltrWidth * ((anchorX+1)/2));\n  var topy = Math.round(y - (lines.length - 1) * ltrHeight * ((anchorY+1)/2));\n  // iterate\n  for(var r = 0; r < lines.length; ++r) {\n    var indent = Math.round((maxcol - lines[r].length) * align * ltrWidth);\n    for(var c = 0; c < lines[r].length; ++c) {\n      this.blit(\n        this.font, lines[r].charCodeAt(c) - 32, \n        leftx + indent + c * ltrWidth,\n        topy + r * ltrHeight,\n        anchorX, anchorY\n      );\n    }\n  }\n};\n\npxcan.prototype.border =\npxcan.Panel.prototype.border = function(sheet) {\n  sheet = sheet || \"pxcan-border\";\n  // temporarily store origin and offset, then set them\n  var oldOrigin = this.origin();\n  var oldOffset = this.offset();\n  this.origin(-1,-1);\n  this.offset(0,0);\n  // horizontal edges\n  var sw = this.sheet(sheet).spriteWidth;\n  for(var x = sw; x < this.width - sw; x += sw) {\n    this.blit(sheet, {col:1, row:0}, x, 0, -1, -1);\n    this.blit(sheet, {col:1, row:2}, x, this.height, -1, 1);\n  }\n  // vertical edges\n  var sh = this.sheet(sheet).spriteHeight;\n  for(var y = sh; y < this.height - sh; y += sh) {\n    this.blit(sheet, {col:0, row:1}, 0, y, -1, -1);\n    this.blit(sheet, {col:2, row:1}, this.width, y, 1, -1);\n  }\n  // corners\n  this.blit(sheet, {col:0, row:0}, 0,0, -1, -1);\n  this.blit(sheet, {col:2, row:0}, this.width,0, 1, -1);\n  this.blit(sheet, {col:0, row:2}, 0,this.height, -1, 1);\n  this.blit(sheet, {col:2, row:2}, this.width,this.height, 1, 1);\n  // return origin and offset to old values\n  this.origin(oldOrigin.x, oldOrigin.y);\n  this.offset(oldOffset.x, oldOffset.y);\n};\n\n//preloading module\n(function() {\n  var instances = [];\n  var waitingOn = {};\n  var numReqsFrom = {};\n  var numGlobalReqs = 0;\n  \n  var imgBank = {};\n\n  pxcan.assignId = (function(inst) {\n    var lastId = -1;\n    return function() {\n      instances.push(inst);\n      numReqsFrom[lastId+1] = 0;\n      return ++lastId;\n    };\n  })();\n  \n  pxcan.isPreloading = function(pxc) {\n    return !!numReqsFrom[pxc.id] || numGlobalReqs > 0;\n  }\n  \n  pxcan.preload = function(src, pxc) {\n    var globalCall = !pxc;\n    //validate\n    if(!src) throw new Error(\"missing source image\");\n    //ignore if already preloaded\n    if(imgBank[src]) {\n      console.log(\"note: \"+src+\" was already preloaded.\");\n      return;\n    }\n    //ignore if already preloading\n    if(waitingOn[src]) {\n      if(globalCall) {\n        console.log(\"note: \"+src+\" was already requested to be preloaded\");\n        return;\n      }\n      if(waitingOn[src].indexOf(pxc)>=0) {\n        console.log(\"note: \"+src+\" was already requested to be preloaded by this pxcan\");\n        return;\n      }\n\n      // if requested by second canvas, track that\n      console.log(\"note: \"+src+\" was already requested to be preloaded by a different pxcan\");\n      waitingOn[src].push(pxc);\n      ++numReqsFrom[pxc.id];\n      return;\n    }\n    \n    //keep track of who's loading it\n    if(globalCall) {\n      ++numGlobalReqs;\n    }\n    else {\n      waitingOn[src] = [pxc];\n      ++numReqsFrom[pxc.id];\n    }\n    //load\n    var img = new Image();\n    img.onload = onLoadedFile;\n    img.onerror = function() { throw new Error(\"Failed to load image \" + src); };\n    img.src = src;\n    \n    function onLoadedFile() {\n      //populate imagebank\n      imgBank[src] = {\n        image: img,\n        scaledImages: { 1: document.createElement(\"canvas\") }\n      };\n      imgBank[src].scaledImages[1].width = img.width;\n      imgBank[src].scaledImages[1].height = img.height;\n      imgBank[src].scaledImages[1].getContext('2d').drawImage(img, 0, 0);\n\n      //launch onReady for any ready pxcans\n      if(globalCall) --numGlobalReqs;\n      else waitingOn[src].forEach(p => --numReqsFrom[p.id]);\n\n      if(numGlobalReqs > 0) return;\n      if(waitingOn[src].every(p => numReqsFrom[p.id])) return;\n\n      var affectedInstances = (globalCall? instances : waitingOn[src]);\n\n      affectedInstances.filter(p => !numReqsFrom[p.id]).forEach(function(p) {\n        if(p.onReady) p.onReady.call(p);\n        p.onReady = null;\n      });\n      delete waitingOn[src];\n    }\n  };\n  pxcan.hasImage = function(src) {\n    return !!(imgBank[src]);\n  };\n  pxcan.image = function(src) {\n    if(!pxcan.hasImage(src)) throw new Error(\"invalid image src: \"+src);\n    return imgBank[src].image;\n  };\n  //helper to retrieve and create resized images\n  pxcan.scaledImage = function(src, scale) {\n    if(!imgBank[src]) throw new Error(\"invalid image src: \"+src);\n    //if cached, return it\n    if(imgBank[src].scaledImages[scale]) return imgBank[src].scaledImages[scale];\n  \n    //otherwise here's how we make it\n    var c = document.createElement(\"canvas\");\n    var img = imgBank[src].scaledImages[1];\n    c.width = img.width * scale;\n    c.height = img.height * scale;\n    var ctx = c.getContext('2d');\n    \n    var data = img.getContext('2d').getImageData(0,0,img.width,img.height).data;\n    var i = 0;\n    for(var y = 0; y < img.height; ++y) {\n      for(var x = 0; x < img.width; ++x) {\n        ctx.fillStyle = 'rgba('+data[i]+','+data[i+1]+','+data[i+2]+','+data[i+3]+')';\n        ctx.fillRect(x*scale, y*scale, scale, scale);\n        i+=4;\n      }\n    }\n    \n    //cache and return\n    imgBank[src].scaledImages[scale] = c;\n    return c;\n  };\n})();\n\n\npxcan.Sheet = function(alias, src, spriteWidth, spriteHeight) {\r\n  // properties\r\n  Object.defineProperty(this, 'alias', { get: function() { return alias; } });\r\n  Object.defineProperty(this, 'img', { get: function() { return pxcan.image(src); } });\r\n  Object.defineProperty(this, 'src', { get: function() { return src; } });\r\n  Object.defineProperty(this, 'left', { get: function() { return 0; } });\r\n  Object.defineProperty(this, 'top', { get: function() { return 0; } });\r\n  Object.defineProperty(this, 'width', { get: function() { return this.img.width; } });\r\n  Object.defineProperty(this, 'height', { get: function() { return this.img.height; } });\r\n  Object.defineProperty(this, 'spriteWidth', { get: function() { return spriteWidth || this.img.width; } });\r\n  Object.defineProperty(this, 'spriteHeight', { get: function() { return spriteHeight || this.img.height; } });\r\n  Object.defineProperty(this, 'numCols', { get: function() { return Math.floor(this.img.width / spriteWidth); } });\r\n  Object.defineProperty(this, 'numRows', { get: function() { return Math.floor(this.img.height / spriteHeight); } });\r\n  Object.defineProperty(this, 'numSprites', { get: function() { return this.numCols * this.numRows; } });\r\n};\r\n\r\npxcan.Sheet.prototype.scaledImage = function(scale) {\r\n  return pxcan.scaledImage(this.src, scale);\r\n};\r\n\r\npxcan.Sheet.prototype.getSprite = function(frame) {\r\n  return new pxcan.Sprite(this, frame);\r\n};\r\n\r\npxcan.Sprite = function(sheet, frame) {\r\n  // validate frame\r\n  if(frame === undefined || frame === null)\r\n    throw new Error('bad frame while constructing sprite');\r\n  // if frame is given as a number, get the column and row\r\n  if((typeof frame === \"number\") && (frame%1)===0) {\r\n    frame = { col: frame % sheet.numCols, row: Math.floor(frame / sheet.numCols) };\r\n  }\r\n  // calculate dimensions\r\n  var fx = frame.x!==undefined? frame.x: frame.col? frame.col*sheet.spriteWidth: 0;\r\n  var fy = frame.y!==undefined? frame.y: frame.row? frame.row*sheet.spriteHeight: 0;\r\n  var fw = frame.width!==undefined? frame.width: (frame.col!==undefined? sheet.spriteWidth: sheet.width-fx);\r\n  var fh = frame.height!==undefined? frame.height: (frame.row!==undefined? sheet.spriteHeight: sheet.height-fy);\r\n  \r\n  // properties\r\n  Object.defineProperty(this, 'sheet', { get: function() { return sheet; } });\r\n  Object.defineProperty(this, 'img', { get: function() { return sheet.img; } });\r\n  Object.defineProperty(this, 'left', { get: function() { return fx; } });\r\n  Object.defineProperty(this, 'top', { get: function() { return fy; } });\r\n  Object.defineProperty(this, 'width', { get: function() { return fw; } });\r\n  Object.defineProperty(this, 'height', { get: function() { return fh; } });\r\n};\r\n\r\npxcan.Sprite.prototype.scaledImage = function(scale) {\r\n  return pxcan.scaledImage(this.sheet.src, scale);\r\n};\n\npxcan.globalSheets = {};\r\n\r\n(function() {\r\n  function registerGlobalSheet(src, alias, w, h) {\r\n    pxcan.preload(src);\r\n    pxcan.globalSheets[alias] = new pxcan.Sheet(alias, src, w, h);\r\n  }\r\n  \r\n  registerGlobalSheet(\r\n    \"data:image/png;base64,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\",\r\n    \"pxcan-ascii\", 8, 8\r\n  );\r\n  registerGlobalSheet(\r\n    \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAhElEQVRIie2WwQrAIAxDU/H/fzk7CdHVwdYWdjCXipQX04NqJIlCdVkbAG5q2EAh3NSQgUJCJxaeAaAm+DqONaEpp22a3mgCrrwmTVG5jIwEj8pM4HKa15WpY3AM/m3AagOrNrglyLouJp4aZF1400u4vmhZJmMa7IiPxvsojH1Y9bflAvhRIjH91XRBAAAAAElFTkSuQmCC\",\r\n    \"pxcan-border\", 8, 8\r\n  );\r\n\r\n})();\n\n\r\n// non-standard Math functions useful for games\r\nvar pxMath = {\r\n  // Median\r\n  mid: function() {\r\n    var arr = [];\r\n    for(var i = 0; i < arguments.length; ++i) arr.push(+arguments[i]);\r\n    arr.sort(function(a, b) { return a-b; });\r\n    if(arr.length%2 === 1) return arr[Math.floor(arr.length/2)];\r\n    else return (arr[Math.floor(arr.length/2)] + arr[Math.floor(arr.length/2)-1]) / 2;\r\n  },\r\n  // Clamp\r\n  //  returns val if it's between min and max.\r\n  //  or, returns the min or max value.\r\n  //  can be called with two arguments: then it's between val, -max, and max.\r\n  clamp: function(val, min, max) {\r\n    if(arguments.length === 2) {\r\n      max = arguments[1];\r\n      min = -arguments[1];\r\n    }\r\n    return pxMath.mid(min, val, max);\r\n  }\r\n}\n\n// custom random number generator\r\n//  it can just be called as a function, or it can be seeded\r\npxcan.random = (function() {\r\n  // Hashcode of strings.\r\n  //  http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/\r\n  function hashString(str) {\r\n    var hash = 0, i, chr, len;\r\n    if (str.length == 0) return hash;\r\n    for (i = 0, len = str.length; i < len; i++) {\r\n      chr   = str.charCodeAt(i);\r\n      hash  = ((hash << 5) - hash) + chr;\r\n      hash |= 0; // Convert to 32bit integer\r\n    }\r\n    return hash;\r\n  }\r\n  function getSeed(s) {\r\n    if(typeof(s) === 'number') return s;\r\n    else if(typeof(s) === 'string') return hashString(s);\r\n    else throw new Error('not sure what to do with seed: ' + s);\r\n  }\r\n  function SinRand(s) {\r\n    var seed = getSeed(s);\r\n    var obj = function() {\r\n      var x = Math.sin(seed++) * 10000;\r\n      x -= Math.floor(x);\r\n      if(arguments.length === 0) return x;\r\n      if(arguments.length === 1 && (arguments[0] instanceof Array)) return arguments[0][Math.floor(x*arguments[0].length)];\r\n      if(arguments.length === 1) return Math.floor(x*arguments[0]);\r\n      if(arguments.length === 2) return Math.floor(x*(arguments[1]+1-arguments[0]))+arguments[0];\r\n      else throw new Error('invalid arguments for random generator.');\r\n    };\r\n    obj.seed = function(s) { seed = getSeed(s); };\r\n    obj.create = function(s) {\r\n      return SinRand((s !== undefined)? s: obj());\r\n    };\r\n    return obj;\r\n  };\r\n  return SinRand(Math.random());\r\n})();\n\n// word wrap function by james padolsey\r\n// modified from original\r\n// http://james.padolsey.com/javascript/wordwrap-for-javascript/\r\npxcan.wrapString = function(str, width, maxLines) {\r\n  if (!str) return str;\r\n  var regex = '.{1,' +width+ '}(\\\\s|$)|.{' +width+ '}|.+$';\r\n  var lines = str.match(RegExp(regex, 'g'));\r\n  if(maxLines) lines = lines.slice(0, maxLines);\r\n  for(var i = 0; i < lines.length; ++i) lines[i] = lines[i].trim();\r\n  return lines.join('\\n');\r\n};"]}