<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>Sample Game</title>
  <style>
    body {
      background-color: #303030;
    }
    div#game {
      display: block;
      width: 352px;
      height: 288px;
      padding: 0;
      margin: 24px auto;
      border: 8px solid #404040;
    }
    div#game:focus {
      border: 8px solid #FFF;
    }
  </style>
  <script src="../build/nigelgame.js"></script>
  <script src="game.js"></script>
</head>
<body>
  <div id="game"></div>
  <script>
    var screen = new pxcan("#game");
    screen.mode("adapt", 3);
    screen.offset(0,0);
    screen.setBackground("black");
    screen.contextMenu = false;
    
    screen.onReady = function() {
      this.write('draw', 0,0);
    };
    
    screen.onFrame = function() {
      if (this.touch.changed) {
        var tch = this.touch;
        var color = tch.isRightClick ? 'red': 'white';
        var size = tch.isMouse? 1 : 10;

        if (tch.moved && tch.isDown) {
          drawLine(this, color, size, tch.last.bounded().x, tch.last.bounded().y, tch.bounded().x, tch.bounded().y);
        }
        else if (tch.wasStarted) {
          this.fill(color, tch.x, tch.y, size, size);
        }
        else if (tch.wasReleased && tch.isDrag) {
          drawLine(this, 'gray', size, tch.start.x, tch.start.y, tch.x, tch.y);
        }
        else if (tch.wasInterrupted) {
          this.fill('orange');
        }
        if (!tch.inBounds && tch.last.inBounds) {
          this.write('out of bounds', 0,0);
        }
      }
      // tch.changed, tch.isDown, tch.isMouse, tch.isRightClick, tch.wasStarted, 
      // tch.moved, tch.isDrag, tch.wasReleased, tch.wasInterrupted

      // tch.(point) : cur, last, start
      // point.x, point.y, point.inBounds, point.ref
      // point.rel(scr, 'bounded'|'b'), point.rel(scr, ['unbounded'|'u'])
      // point.bounded(), point.unbounded()

      // tch.x, tch.y, tch.inBounds, tch.rel(), tch.bounded(), tch.unbounded()
    };

    function drawLine(screen, color, size, x0,y0, x1,y1) {
      var dx = Math.abs(x1-x0);
      var dy = Math.abs(y1-y0);
      var sx = (x0 < x1) ? 1 : -1;
      var sy = (y0 < y1) ? 1 : -1;
      var err = dx-dy;

      while(true){
        screen.fill(color, x0,y0, size,size);

        if ((x0==x1) && (y0==y1)) break;
        var e2 = 2*err;
        if (e2 >-dy){ err -= dy; x0  += sx; }
        if (e2 < dx){ err += dx; y0  += sy; }
      }
    }
  </script>
</body>
</html>